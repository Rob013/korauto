import{s as e}from"./client-ClhMjqWB.js";async function r(r){const{filters:a={},sort:c="price_asc",limit:t=24,cursor:s}=r,{field:i,direction:n}=function(e){const r=function(e){if(["price_asc","price_desc","rank_asc","rank_desc","year_asc","year_desc","mileage_asc","mileage_desc","make_asc","make_desc","created_asc","created_desc"].includes(e))return e;switch(e){case"price_low":default:return"price_asc";case"price_high":return"price_desc";case"year_new":return"year_desc";case"year_old":return"year_asc";case"mileage_low":return"mileage_asc";case"mileage_high":return"mileage_desc";case"make_az":return"make_asc";case"make_za":return"make_desc";case"recently_added":return"created_desc";case"oldest_first":return"created_asc";case"popular":return"rank_desc"}}(e);switch(r){case"price_asc":default:return{field:"price_cents",direction:"ASC"};case"price_desc":return{field:"price_cents",direction:"DESC"};case"rank_asc":return{field:"rank_score",direction:"ASC"};case"rank_desc":return{field:"rank_score",direction:"DESC"};case"year_asc":return{field:"year",direction:"ASC"};case"year_desc":return{field:"year",direction:"DESC"};case"mileage_asc":return{field:"mileage",direction:"ASC"};case"mileage_desc":return{field:"mileage",direction:"DESC"};case"make_asc":return{field:"make",direction:"ASC"};case"make_desc":return{field:"make",direction:"DESC"};case"created_asc":return{field:"created_at",direction:"ASC"};case"created_desc":return{field:"created_at",direction:"DESC"}}}(c),_=s?function(e){if(!e)return null;try{const r=atob(e),[a,c]=r.split("|");return a&&c?{value:a,id:c}:null}catch{return null}}(s):null,d={...a};try{const{data:r,error:a}=await e.rpc("cars_filtered_count",{p_filters:d});if(a)throw a;const{data:c,error:s}=await e.rpc("cars_keyset_page",{p_filters:d,p_sort_field:i,p_sort_dir:n,p_cursor_value:_?.value||null,p_cursor_id:_?.id||null,p_limit:t});if(s)throw s;const l=c||[];let o;if(l.length===t){const e=l[l.length-1];let r;switch(i){case"price_cents":default:r=e.price_cents;break;case"rank_score":r=e.rank_score;break;case"year":r=e.year;break;case"mileage":r=e.mileage;break;case"make":r=e.make;break;case"created_at":r=e.created_at}o=function(e,r,a){return btoa(`${r}|${a}`)}(0,r,e.id)}return{items:l,nextCursor:o,total:r||0}}catch(l){throw l}}export{r as f};
