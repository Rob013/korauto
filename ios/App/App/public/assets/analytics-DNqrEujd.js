import{s as e}from"./client-ClhMjqWB.js";const a=async()=>{try{return null}catch{return null}},t=async t=>{try{const i=(()=>{let e=sessionStorage.getItem("analytics_session_id");return e||(e=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,sessionStorage.setItem("analytics_session_id",e)),e})(),{data:{user:n}}=await e.auth.getUser(),o={action_type:t.action_type,page_url:t.page_url,page_title:t.page_title||document.title,car_id:t.car_id,session_id:i,user_id:n?.id||null,ip_address:await a(),referrer:t.referrer||document.referrer||null,user_agent:t.user_agent||navigator.userAgent,metadata:t.metadata||null,created_at:(new Date).toISOString()},{error:r}=await e.from("website_analytics").insert(o)}catch(i){}},i=(e,a)=>{t({action_type:"page_view",page_url:window.location.pathname+window.location.search,page_title:document.title,car_id:e,metadata:a})},n=(e,a)=>{t({action_type:"car_view",page_url:window.location.pathname+window.location.search,car_id:e,metadata:a?{make:a.make,model:a.model,year:a.year,price:a.price}:void 0})},o=(e,a)=>{t({action_type:"inspection_request",page_url:window.location.pathname,car_id:e,metadata:a})},r=()=>{i(),document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&t({action_type:"page_focus",page_url:window.location.pathname+window.location.search})});const e=Date.now();window.addEventListener("beforeunload",()=>{const a=Math.round((Date.now()-e)/1e3);t({action_type:"page_time",page_url:window.location.pathname+window.location.search,metadata:{time_on_page_seconds:a}})})};export{n as a,o as b,r as i,i as t};
