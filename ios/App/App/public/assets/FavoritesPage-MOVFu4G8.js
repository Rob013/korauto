const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Footer-DRRobR63.js","assets/ui-5CGx59HE.js","assets/vendor-Ce2S7JN_.js","assets/router-CrtsEgIx.js","assets/phone-hADAJvIR.js","assets/index-DXJv48IP.js","assets/supabase-FBsvvB2P.js","assets/utils-DN5cgeP9.js","assets/query-D7el4M-V.js","assets/index-CQ5W8qV3.css","assets/map-pin-k_93RLhL.js"])))=>i.map(i=>d[i]);
import{_ as e}from"./supabase-FBsvvB2P.js";import{j as s}from"./ui-5CGx59HE.js";import{r as a}from"./vendor-Ce2S7JN_.js";import{s as t}from"./client-ClhMjqWB.js";import r from"./Header-CbL792xF.js";import{d as i,u as n,B as l,S as o}from"./index-DXJv48IP.js";import{u as c}from"./useImagePreload-BhQVUTkH.js";import{b as d}from"./router-CrtsEgIx.js";import{C as m}from"./car-BxrBaIAr.js";import{G as u}from"./gauge-C77d0s-O.js";import{S as x}from"./settings-CifkK-3H.js";import{F as h,P as p}from"./palette-CnXSA3iB.js";import{H as g}from"./heart-j_9DbFLM.js";import{A as j}from"./arrow-left-nPPkI31a.js";import"./user-CjHCORYF.js";import"./utils-DN5cgeP9.js";import"./query-D7el4M-V.js";const f=({src:e,alt:t,className:r="",priority:i=!1,quality:n=80,width:l=300,enableLazyLoad:o=!0,enableProgressiveLoad:d=!0,onLoad:m,onError:u,...x})=>{const{imgRef:h,isLoaded:p,isError:g,isLoading:j,optimizedSrc:f,shouldShowPlaceholder:v}=c(e,{priority:i,quality:n,width:l,enableLazyLoad:o,enableProgressiveLoad:d});return a.useEffect(()=>{p&&m&&m(),g&&u&&u()},[p,g,m,u]),s.jsxs("div",{className:`relative overflow-hidden ${r}`,children:[v&&s.jsx("div",{className:"absolute inset-0 bg-muted animate-pulse flex items-center justify-center",style:{aspectRatio:`${l}/160`,minHeight:"160px"},children:j&&s.jsx("div",{className:"text-xs text-muted-foreground",children:"Loading..."})}),g&&s.jsx("div",{className:"absolute inset-0 bg-muted flex items-center justify-center",style:{aspectRatio:`${l}/160`,minHeight:"160px"},children:s.jsx("div",{className:"text-xs text-muted-foreground",children:"Image failed to load"})}),s.jsx("img",{ref:h,src:!o||i?f:"",alt:t,className:"w-full h-full object-cover transition-opacity duration-300 optimized-image "+(p?"opacity-100":"opacity-0"),style:{aspectRatio:`${l}/160`,objectFit:"cover",minHeight:"160px",backgroundColor:"hsl(var(--muted))"},loading:i?"eager":"lazy",decoding:"async",...x})]})},v=({id:e,make:r,model:o,year:c,price:j,image:v,vin:N,mileage:b,transmission:y,fuel:w,color:_,condition:k,lot:S,title:L,status:z,sale_status:C,final_price:H,generation:P,body_type:q,engine:D,drive_wheel:R,vehicle_type:$,cylinders:E,bid:A,estimate_repair_price:I,pre_accident_price:M,clean_wholesale_price:T,actual_cash_value:K,sale_date:U,seller:O,seller_type:B,detailed_title:F,damage_main:J,damage_second:G,keys_available:V,airbags:W,grade_iaai:Y,domain:Q,external_id:X,is_archived:Z,archived_at:ee,archive_reason:se,insurance:ae,insurance_v2:te,location:re,inspect:ie,details:ne})=>{const le=d(),{setPreviousPage:oe}=i(),{toast:ce}=n(),[de,me]=a.useState(!1),[ue,xe]=a.useState(null),[he,pe]=a.useState(!1),ge=(()=>{if(Z&&ee&&"sold"===se)try{const e=new Date(ee);return!!isNaN(e.getTime())||((new Date).getTime()-e.getTime())/36e5>24.5}catch(e){return!0}return!1})();return a.useEffect(()=>{(async()=>{const{data:{user:s}}=await t.auth.getUser();if(xe(s),s){const{data:a}=await t.from("user_roles").select("role").eq("user_id",s.id).maybeSingle();pe("admin"===a?.role);const{data:r}=await t.from("favorite_cars").select("id").eq("user_id",s.id).eq("car_id",e).maybeSingle();me(!!r)}})();const{data:{subscription:s}}=t.auth.onAuthStateChange((e,s)=>{xe(s?.user??null),s?.user||me(!1)});return()=>s.unsubscribe()},[e]),ge?null:s.jsxs("div",{className:"glass-card card-hover overflow-hidden cursor-pointer group touch-manipulation relative rounded-lg",onClick:()=>{const e={scrollTop:window.scrollY,timestamp:Date.now(),url:window.location.pathname+window.location.search};sessionStorage.setItem("encar-catalog-scroll",JSON.stringify(e)),oe(window.location.pathname+window.location.search),window.open(`/car/${S}`,"_blank")},style:{minHeight:"320px",aspectRatio:"280/320"},children:[s.jsxs("div",{className:"relative h-40 bg-muted overflow-hidden",children:[v?s.jsx(f,{src:v,alt:`${c} ${r} ${o}`,className:"w-full h-full group-hover:scale-110 transition-transform duration-500 ease-out",width:280,priority:!1,enableLazyLoad:!0,enableProgressiveLoad:!0}):s.jsx("div",{className:"w-full h-full flex items-center justify-center bg-muted",style:{aspectRatio:"280/160"},children:s.jsx(m,{className:"h-16 w-16 text-muted-foreground"})}),3===z||"sold"===C?s.jsx("div",{className:"absolute top-2 right-2 bg-red-600 text-white px-3 py-1 rounded text-xs font-bold shadow-lg z-10",children:"E SHITUR"}):S&&s.jsxs("div",{className:"absolute top-2 right-2 bg-primary text-primary-foreground px-2 py-1 rounded text-xs font-semibold",children:["Kodi #",S]})]}),s.jsxs("div",{className:"p-3 flex flex-col flex-1",style:{minHeight:"160px"},children:[s.jsxs("div",{className:"mb-2",children:[s.jsxs("h3",{className:"text-base font-semibold text-foreground line-clamp-1",style:{minHeight:"1.5rem"},children:[c," ",r," ",o]}),L&&L!==`${r} ${o}`&&s.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1",style:{minHeight:"1rem"},children:L})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3 text-xs",style:{minHeight:"3rem"},children:[b&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(u,{className:"h-3 w-3 text-muted-foreground flex-shrink-0"}),s.jsx("span",{className:"truncate text-muted-foreground",children:b})]}),y&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(x,{className:"h-3 w-3 text-muted-foreground flex-shrink-0"}),s.jsx("span",{className:"capitalize truncate text-muted-foreground",children:y})]}),w&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(h,{className:"h-3 w-3 text-muted-foreground flex-shrink-0"}),s.jsx("span",{className:"capitalize truncate text-muted-foreground",children:w})]}),_&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(p,{className:"h-3 w-3 text-muted-foreground flex-shrink-0"}),s.jsx("span",{className:"capitalize truncate text-muted-foreground",children:_})]})]}),s.jsxs("div",{className:"space-y-2 mt-auto",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"text-lg font-bold text-primary",children:["€",j.toLocaleString()]}),s.jsx(l,{size:"sm",variant:"ghost",onClick:async s=>{if(s.stopPropagation(),!ue)return ce({title:"Identifikimi i nevojshëm",description:"Ju lutem identifikohuni për të ruajtur makinat e preferuara"}),void le("/auth");try{de?(await t.from("favorite_cars").delete().eq("user_id",ue.id).eq("car_id",e),me(!1),ce({title:"Hequr nga të preferuarat",description:"Makina u hoq nga të preferuarat tuaja"})):(await t.from("favorite_cars").insert({user_id:ue.id,car_id:e,car_make:r,car_model:o,car_year:c,car_price:j,car_image:v}),me(!0),ce({title:"Shtuar në të preferuarat",description:"Makina u ruajt në të preferuarat tuaja"}))}catch(a){ce({title:"Gabim",description:"Dështoi përditësimi i të preferuarave",variant:"destructive"})}},className:"h-8 w-8 p-0 hover:bg-muted touch-target interactive-element hover:scale-110 transition-all duration-200",style:{minHeight:"44px",minWidth:"44px"},children:s.jsx(g,{className:"h-4 w-4 transition-all duration-200 "+(de?"fill-red-500 text-red-500 animate-bounce-in":"hover:text-red-400")})})]}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Deri ne portin e Durresit"})]}),s.jsx("div",{className:"text-center pt-2 border-t border-border/50",children:s.jsx("p",{className:"text-xs text-muted-foreground font-medium",children:"KORAUTO"})})]})]})},N=a.lazy(()=>e(()=>import("./Footer-DRRobR63.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),b=()=>s.jsx("footer",{className:"bg-card",children:s.jsx("div",{className:"container-responsive py-8",children:s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[...Array(4)].map((e,a)=>s.jsxs("div",{className:"space-y-3",children:[s.jsx(o,{className:"h-5 w-24"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{className:"h-4 w-full"}),s.jsx(o,{className:"h-4 w-3/4"}),s.jsx(o,{className:"h-4 w-1/2"})]})]},a))})})}),y=()=>{const[e,i]=a.useState(null),[n,o]=a.useState([]),[c,m]=a.useState(!0),u=d();a.useEffect(()=>{(async()=>{const{data:{user:e}}=await t.auth.getUser();i(e),e?x(e.id):m(!1)})();const{data:{subscription:e}}=t.auth.onAuthStateChange((e,s)=>{i(s?.user??null),s?.user?x(s.user.id):(o([]),m(!1))});return()=>e.unsubscribe()},[]);const x=async e=>{try{const s=[{id:"1",car_id:"1",user_id:e,created_at:(new Date).toISOString(),cars:{make:"BMW",model:"M3",year:2022,price:67300,image_url:"https://images.unsplash.com/photo-1555215695-3004980ad54e?w=800"}},{id:"2",car_id:"2",user_id:e,created_at:(new Date).toISOString(),cars:{make:"Mercedes-Benz",model:"C-Class",year:2021,price:47300,image_url:"https://images.unsplash.com/photo-1563720223185-11003d516935?w=800"}}];o(s)}catch(s){}finally{m(!1)}};return e?c?s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx(r,{}),s.jsxs("div",{className:"container-responsive py-16 text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),s.jsx("p",{className:"text-muted-foreground",children:"Loading your favorites..."})]}),s.jsx(a.Suspense,{fallback:s.jsx(b,{}),children:s.jsx(N,{})})]}):s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx(r,{}),s.jsxs("div",{className:"container-responsive py-8",children:[s.jsxs("div",{className:"flex items-center justify-between mb-8",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(g,{className:"h-8 w-8 text-red-500"}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold",children:"Makinat e Mia të Preferuara"}),s.jsxs("p",{className:"text-muted-foreground",children:[n.length," makinë",1!==n.length?"a":""," e ruajtur"]})]})]}),s.jsxs(l,{variant:"outline",onClick:()=>u("/"),children:[s.jsx(j,{className:"h-4 w-4 mr-2"}),"Kthehu për të Shfletuar"]})]}),0===n.length?s.jsxs("div",{className:"text-center py-16",children:[s.jsx(g,{className:"h-16 w-16 text-muted-foreground mx-auto mb-6"}),s.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Asnjë të Preferuar Akoma"}),s.jsx("p",{className:"text-muted-foreground mb-8",children:"Filloni të shfletoni makinat dhe klikoni ikonën e zemrës për të ruajtur të preferuarat tuaja"}),s.jsx(l,{onClick:()=>u("/"),children:"Shfleto Makinat"})]}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:n.map(e=>s.jsx(v,{id:e.car_id,make:e.cars?.make||"Unknown",model:e.cars?.model||"Unknown",year:e.cars?.year||0,price:e.cars?.price||0,image:e.cars?.image_url},e.id))})]}),s.jsx(a.Suspense,{fallback:s.jsx(b,{}),children:s.jsx(N,{})})]}):s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsx(r,{}),s.jsxs("div",{className:"container-responsive py-16 text-center",children:[s.jsx(g,{className:"h-16 w-16 text-muted-foreground mx-auto mb-6"}),s.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Duhet të Kyçeni"}),s.jsx("p",{className:"text-muted-foreground mb-8",children:"Ju lutemi kyçuni për të parë makinat tuaja të preferuara"}),s.jsxs("div",{className:"space-x-4",children:[s.jsx(l,{onClick:()=>u("/auth"),children:"Kyçu / Regjistrohu"}),s.jsxs(l,{variant:"outline",onClick:()=>u("/"),children:[s.jsx(j,{className:"h-4 w-4 mr-2"}),"Kthehu në Kryefaqe"]})]})]}),s.jsx(a.Suspense,{fallback:s.jsx(b,{}),children:s.jsx(N,{})})]})};export{y as default};
