var e=Object.defineProperty,t=(t,i,n)=>((t,i,n)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[i]=n)(t,"symbol"!=typeof i?i+"":i,n);import{t as i}from"./index-DXJv48IP.js";class n{constructor(){t(this,"observer",null),t(this,"performanceObserver",null),t(this,"metrics",{}),t(this,"layoutShiftScore",0),t(this,"animationFrameTimes",[]),t(this,"scrollData",[]),this.initializeObservers()}initializeObservers(){if("PerformanceObserver"in window){this.performanceObserver=new PerformanceObserver(e=>{for(const t of e.getEntries())"layout-shift"!==t.entryType||t.hadRecentInput||(this.layoutShiftScore+=t.value)});try{this.performanceObserver.observe({entryTypes:["layout-shift"]})}catch(e){}}this.monitorAnimationFrameRate(),this.monitorScrollPerformance()}monitorAnimationFrameRate(){let e=performance.now(),t=0;const i=()=>{const n=performance.now(),o=n-e;if(o>=1e3){const i=Math.round(1e3*t/o);this.animationFrameTimes.push(i),this.animationFrameTimes.length>10&&this.animationFrameTimes.shift(),t=0,e=n}t++,requestAnimationFrame(i)};requestAnimationFrame(i)}monitorScrollPerformance(){const e=i(e=>{const t=performance.now(),i=window.scrollY;this.scrollData.push({timestamp:t,position:i}),this.scrollData.length>50&&this.scrollData.shift()},16);window.addEventListener("scroll",e,{passive:!0})}async checkAlignmentIssues(){const e=[];return document.querySelectorAll("*").forEach(t=>{const i=t.getBoundingClientRect(),n=window.getComputedStyle(t);if(0!==i.width&&0!==i.height){if(this.isTextElement(t)){const o=n.textAlign,s=parseFloat(n.paddingLeft),r=parseFloat(n.paddingRight);"center"===o&&Math.abs(s-r)>2&&e.push({element:this.getElementSelector(t),issue:"Uneven padding on centered text",severity:"medium",suggested_fix:"Ensure equal left and right padding for centered text",position:{top:i.top,left:i.left,width:i.width,height:i.height}})}(t.classList.contains("card")||t.classList.contains("CarCard"))&&this.checkCardAlignment(t,i,e),"IMG"===t.tagName&&this.checkImageAlignment(t,i,e),("BUTTON"===t.tagName||t.classList.contains("btn"))&&this.checkButtonAlignment(t,i,n,e)}}),e}isTextElement(e){return["P","H1","H2","H3","H4","H5","H6","SPAN","DIV"].includes(e.tagName)&&""!==e.textContent?.trim()}checkCardAlignment(e,t,i){const n=Array.from(e.children);for(let o=1;o<n.length;o++){const s=n[o-1].getBoundingClientRect(),r=n[o].getBoundingClientRect().top-(s.top+s.height);if(o>1){const a=n[o-2].getBoundingClientRect(),l=s.top-(a.top+a.height);if(Math.abs(r-l)>4){i.push({element:this.getElementSelector(e),issue:"Inconsistent spacing between card elements",severity:"low",suggested_fix:"Use consistent margin/padding for card children",position:{top:t.top,left:t.left,width:t.width,height:t.height}});break}}}}checkImageAlignment(e,t,i){if(e.naturalWidth&&e.naturalHeight){const n=e.naturalWidth/e.naturalHeight,o=t.width/t.height;Math.abs(n-o)>.1&&i.push({element:this.getElementSelector(e),issue:"Image aspect ratio distortion",severity:"medium",suggested_fix:"Use object-fit: cover or maintain proper aspect ratio",position:{top:t.top,left:t.left,width:t.width,height:t.height}})}e.alt&&""!==e.alt.trim()||i.push({element:this.getElementSelector(e),issue:"Missing alt text for accessibility",severity:"high",suggested_fix:"Add descriptive alt text for screen readers",position:{top:t.top,left:t.left,width:t.width,height:t.height}})}checkButtonAlignment(e,t,i,n){(t.width<44||t.height<44)&&n.push({element:this.getElementSelector(e),issue:"Button too small for touch interaction",severity:"high",suggested_fix:"Ensure minimum 44px touch target size",position:{top:t.top,left:t.left,width:t.width,height:t.height}})}getElementSelector(e){if(e.id)return`#${e.id}`;if(e.className){const t=e.className.split(" ").filter(e=>""!==e.trim());if(t.length>0)return`.${t[0]}`}return e.tagName.toLowerCase()}async measureImageLoadTime(){const e=document.querySelectorAll("img"),t=[];for(const n of e){if(n.complete)continue;const e=performance.now();try{await new Promise((e,t)=>{n.onload=e,n.onerror=t,setTimeout(()=>t(new Error("Image load timeout")),5e3)});const i=performance.now();t.push(i-e)}catch(i){t.push(5e3)}}return t.length>0?t.reduce((e,t)=>e+t)/t.length:0}calculateScrollPerformance(){if(this.scrollData.length<2)return 100;let e=100;for(let t=1;t<this.scrollData.length;t++){const i=this.scrollData[t].timestamp-this.scrollData[t-1].timestamp,n=Math.abs(this.scrollData[t].position-this.scrollData[t-1].position);i>0&&n/i>2&&(e-=5)}return Math.max(0,e)}calculateAnimationSmoothness(){if(0===this.animationFrameTimes.length)return 100;const e=this.animationFrameTimes.reduce((e,t)=>e+t)/this.animationFrameTimes.length/60*100,t=this.calculateVariance(this.animationFrameTimes),i=Math.min(t,20);return Math.max(0,Math.min(100,e-i))}calculateVariance(e){const t=e.reduce((e,t)=>e+t)/e.length,i=e.map(e=>Math.pow(e-t,2));return i.reduce((e,t)=>e+t)/i.length}async runFullAudit(){const e=await this.checkAlignmentIssues(),t=await this.measureImageLoadTime(),i=this.calculateScrollPerformance(),n=this.calculateAnimationSmoothness(),o=(i+n)/2,s=(Math.max(0,100-10*e.length)+Math.max(0,100-t/100)+Math.max(0,100-100*this.layoutShiftScore)+o)/4;return{layoutShifts:this.layoutShiftScore,animationFrameRate:n,imageLoadTime:t,scrollPerformance:i,alignmentIssues:e,smoothnessScore:o,overallScore:s}}generateReport(e){let t=`\nüöÄ KORAUTO Performance Audit Report\n====================================\n\nüìà Overall Score: ${e.overallScore.toFixed(1)}/100\n\nüìä Detailed Metrics:\n- Layout Shifts: ${e.layoutShifts.toFixed(3)} (Lower is better)\n- Animation Frame Rate: ${e.animationFrameRate.toFixed(1)}% smooth\n- Image Load Time: ${e.imageLoadTime.toFixed(0)}ms average\n- Scroll Performance: ${e.scrollPerformance.toFixed(1)}/100\n- Smoothness Score: ${e.smoothnessScore.toFixed(1)}/100\n\nüîç Alignment Issues Found: ${e.alignmentIssues.length}\n`;return e.alignmentIssues.length>0&&(t+="\n‚ö†Ô∏è  Issues to Fix:\n",e.alignmentIssues.forEach((e,i)=>{t+=`${i+1}. ${e.element}: ${e.issue} (${e.severity})\n`,t+=`   üí° Fix: ${e.suggested_fix}\n\n`})),t+="\nüìù Recommendations:\n",e.overallScore<80&&(t+="- Overall performance needs improvement\n"),e.layoutShifts>.1&&(t+="- Reduce layout shifts by setting explicit dimensions\n"),e.animationFrameRate<90&&(t+="- Optimize animations for better frame rate\n"),e.imageLoadTime>1e3&&(t+="- Optimize image loading and compression\n"),e.scrollPerformance<90&&(t+="- Improve scroll performance with better debouncing\n"),t}async applyAutoFixes(e){let t=0;for(const n of e)try{const e=document.querySelector(n.element);if(!e)continue;switch(n.issue){case"Button too small for touch interaction":e.style.minHeight="44px",e.style.minWidth="44px",e.style.padding="8px 16px",t++;break;case"Image aspect ratio distortion":e.style.objectFit="cover",e.style.objectPosition="center",t++;break;case"Missing alt text for accessibility":"IMG"===e.tagName&&(e.alt=e.getAttribute("data-description")||"Car image",t++);break;case"Poor color contrast":e.style.filter="contrast(1.2)",t++;break;case"Missing focus outline":e.style.outline="2px solid hsl(var(--ring))",e.style.outlineOffset="2px",t++;break;case"Layout shift causing":e.style.minHeight=e.offsetHeight+"px",e.style.minWidth=e.offsetWidth+"px",t++;break;case"Missing dimensions causing potential layout shifts":if("IMG"===e.tagName){const i=e;i.naturalWidth&&i.naturalHeight&&(i.style.aspectRatio=`${i.naturalWidth} / ${i.naturalHeight}`,t++)}break;case"Text content overflows container":e.style.overflow="hidden",e.style.textOverflow="ellipsis",e.style.whiteSpace="nowrap",t++;break;case"Extremely high z-index may cause stacking issues":e.style.zIndex="10",t++;break;case"Fixed pixel width may break responsive design":const i=e.style.width;i&&i.includes("px")&&(e.style.maxWidth=i,e.style.width="100%",t++);break;case"Missing ARIA label on interactive element":e.getAttribute("aria-label")||(e.setAttribute("aria-label",e.textContent?.trim()||"Interactive element"),t++);break;case"Form input without associated label":!e.getAttribute("aria-label")&&e.id&&(e.setAttribute("aria-label",e.id.replace(/[-_]/g," ")),t++)}}catch(i){}return t}async runAccessibilityAudit(){const e=[],t=16,i=15;let n=0,o=0;if(o<t&&n<i){const i=document.querySelectorAll("img");for(const s of i){if(o>=t)break;if(!s.alt||""===s.alt.trim()){const t=s.getBoundingClientRect();e.push({element:this.getElementSelector(s),issue:"Missing alt text for accessibility",severity:"high",suggested_fix:"Add descriptive alt text for screen readers",position:{top:t.top,left:t.left,width:t.width,height:t.height}}),n++,o++}}}if(o<t&&n<i){const i=document.querySelectorAll("button, a, input, select, textarea");for(const s of i){if(o>=t)break;if(!s.getAttribute("aria-label")&&!s.getAttribute("aria-labelledby")&&!s.textContent?.trim()&&"INPUT"!==s.tagName){const t=s.getBoundingClientRect();e.push({element:this.getElementSelector(s),issue:"Missing ARIA label on interactive element",severity:"high",suggested_fix:"Add aria-label or aria-labelledby attribute",position:{top:t.top,left:t.left,width:t.width,height:t.height}}),n++,o++}}}if(o<t&&n<i){const i=document.querySelectorAll("input, select, textarea");for(const s of i){if(o>=t)break;if(!(s.getAttribute("aria-labelledby")||s.getAttribute("aria-label")||document.querySelector(`label[for="${s.id}"]`)||s.closest("label"))&&"hidden"!==s.type&&"submit"!==s.type&&"button"!==s.type){const t=s.getBoundingClientRect();e.push({element:this.getElementSelector(s),issue:"Form input without associated label",severity:"high",suggested_fix:"Add a label element or aria-label attribute",position:{top:t.top,left:t.left,width:t.width,height:t.height}}),n++,o++}}}if(o<t&&n<i){const i=document.querySelectorAll("a");for(const s of i){if(o>=t)break;const i=s.textContent?.trim()||s.getAttribute("aria-label")||s.getAttribute("title");if(!i||i.length<3||["click","here","link","more"].includes(i.toLowerCase())){const t=s.getBoundingClientRect();e.push({element:this.getElementSelector(s),issue:"Link without descriptive text",severity:"high",suggested_fix:"Add descriptive link text or aria-label",position:{top:t.top,left:t.left,width:t.width,height:t.height}}),n++,o++}}}if(o<t&&n<i&&(document.querySelector('a[href="#main"], a[href="#content"], .skip-link')||(e.push({element:"body",issue:"Missing skip navigation link",severity:"high",suggested_fix:"Add a skip navigation link at the beginning of the page",position:{top:0,left:0,width:0,height:0}}),n++,o++)),o<t&&n<i&&(document.querySelector('main, [role="main"]')||(e.push({element:"body",issue:"Missing main landmark",severity:"high",suggested_fix:'Add <main> element or role="main"',position:{top:0,left:0,width:0,height:0}}),n++,o++)),o<t&&n<i&&(document.querySelector('nav, [role="navigation"]')||(e.push({element:"body",issue:"Missing navigation landmark",severity:"high",suggested_fix:'Add <nav> element or role="navigation"',position:{top:0,left:0,width:0,height:0}}),n++,o++)),o<t&&n<i){const t=document.title;(!t||t.trim().length<3)&&(e.push({element:"title",issue:"Missing or inadequate page title",severity:"high",suggested_fix:"Add a descriptive page title",position:{top:0,left:0,width:0,height:0}}),n++,o++)}if(o<t&&n<i){const i=document.querySelectorAll("h1, h2, h3, h4, h5, h6");let s=0;for(const r of i){if(o>=t)break;const i=parseInt(r.tagName.substring(1));if(i>s+1){const t=r.getBoundingClientRect();e.push({element:this.getElementSelector(r),issue:"Improper heading hierarchy",severity:"high",suggested_fix:"Use proper heading order (h1, h2, h3, etc.)",position:{top:t.top,left:t.left,width:t.width,height:t.height}}),n++,o++}s=i}}if(o<t&&n<i){const i=document.querySelectorAll("button, a, input, select, textarea, [tabindex]");for(const s of i){if(o>=t)break;const i=window.getComputedStyle(s);if("none"===i.outline&&!i.boxShadow.includes("ring")&&!i.border.includes("focus")){const t=s.getBoundingClientRect();e.push({element:this.getElementSelector(s),issue:"Missing focus outline",severity:"high",suggested_fix:"Add focus outline for keyboard navigation",position:{top:t.top,left:t.left,width:t.width,height:t.height}}),n++,o++}}}if(o<t&&n<i){const i=document.querySelectorAll('button, [role="button"]');for(const s of i){if(o>=t)break;const i=s.getBoundingClientRect();(i.width<44||i.height<44)&&(e.push({element:this.getElementSelector(s),issue:"Button too small for touch interaction",severity:"high",suggested_fix:"Ensure minimum 44px touch target size",position:{top:i.top,left:i.left,width:i.width,height:i.height}}),n++,o++)}}if(o<t&&n<i&&(document.documentElement.getAttribute("lang")||(e.push({element:"html",issue:"Missing language attribute",severity:"high",suggested_fix:"Add lang attribute to html element",position:{top:0,left:0,width:0,height:0}}),n++,o++)),o<t&&n<i){const i=document.querySelectorAll("p, span, div, h1, h2, h3, h4, h5, h6, a, button, label");let s=0;for(const r of i){if(o>=t||s>=2)break;const i=window.getComputedStyle(r),a=i.color,l=i.backgroundColor;if(this.hasLowContrast(a,l)){const t=r.getBoundingClientRect();e.push({element:this.getElementSelector(r),issue:"Poor color contrast",severity:"high",suggested_fix:"Improve color contrast ratio to meet WCAG standards",position:{top:t.top,left:t.left,width:t.width,height:t.height}}),n++,o++,s++}}}if(o<t&&n<i){const i=document.querySelectorAll("table");for(const s of i){if(o>=t)break;if(!s.querySelector("th")&&!s.querySelector("[scope]")){const t=s.getBoundingClientRect();e.push({element:this.getElementSelector(s),issue:"Table without proper headers",severity:"high",suggested_fix:"Add th elements or scope attributes to table headers",position:{top:t.top,left:t.left,width:t.width,height:t.height}}),n++,o++}}}if(o<t&&n<i&&document.querySelectorAll("[data-dynamic], .loading, .error, .success").length>0&&(document.querySelector('[aria-live], [role="status"], [role="alert"]')||(e.push({element:"body",issue:"Missing live regions for dynamic content updates",severity:"high",suggested_fix:"Add aria-live regions for dynamic content announcements",position:{top:0,left:0,width:0,height:0}}),n++,o++)),o<t){const i=document.querySelectorAll("video");for(const n of i){if(o>=t)break;if(!n.querySelector('track[kind="captions"], track[kind="subtitles"]')){const t=n.getBoundingClientRect();e.push({element:this.getElementSelector(n),issue:"Video without captions or subtitles",severity:"medium",suggested_fix:"Add caption tracks for accessibility",position:{top:t.top,left:t.left,width:t.width,height:t.height}}),o++}}}return e.slice(0,t)}hasLowContrast(e,t){if("rgba(0, 0, 0, 0)"===t||"transparent"===t||""===t)return!1;try{const i=this.getLuminance(e),n=this.getLuminance(t);return null!==i&&null!==n&&(Math.max(i,n)+.05)/(Math.min(i,n)+.05)<4.5}catch(i){return!1}}getLuminance(e){try{const t=document.createElement("div");t.style.color=e,document.body.appendChild(t);const i=window.getComputedStyle(t).color;document.body.removeChild(t);const n=i.match(/\d+/g);if(!n||n.length<3)return null;const[o,s,r]=n.map(e=>{const t=parseInt(e)/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)});return.2126*o+.7152*s+.0722*r}catch(t){return null}}destroy(){this.observer&&this.observer.disconnect(),this.performanceObserver&&this.performanceObserver.disconnect()}}export{n as P};
