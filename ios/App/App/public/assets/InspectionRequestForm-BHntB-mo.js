import{c as e,a,X as t,u as s,C as r,b as i,B as n}from"./index-DXJv48IP.js";import{O as m,Q as o,j as l,U as d,W as c,X as p,Y as h,Z as u,_ as f}from"./ui-5CGx59HE.js";import{r as N}from"./vendor-Ce2S7JN_.js";import{I as x}from"./input-BjLg3enW.js";import{L as g}from"./label-CADau4dH.js";import{s as j}from"./client-ClhMjqWB.js";import{b as y}from"./analytics-DNqrEujd.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=e("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),b=e("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),v=m,k=o,P=d,_=N.forwardRef(({className:e,...t},s)=>l.jsx(u,{ref:s,className:a("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */_.displayName=u.displayName;const $=N.forwardRef(({className:e,children:s,...r},i)=>l.jsxs(P,{children:[l.jsx(_,{}),l.jsxs(c,{ref:i,className:a("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[s,l.jsxs(p,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[l.jsx(t,{className:"h-4 w-4"}),l.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));$.displayName=c.displayName;const q=({className:e,...t})=>l.jsx("div",{className:a("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});q.displayName="DialogHeader";const C=N.forwardRef(({className:e,...t},s)=>l.jsx(h,{ref:s,className:a("text-lg font-semibold leading-none tracking-tight",e),...t}));C.displayName=h.displayName,N.forwardRef(({className:e,...t},s)=>l.jsx(f,{ref:s,className:a("text-sm text-muted-foreground",e),...t})).displayName=f.displayName;const M=e=>e.trim().replace(/[<>"'&]/g,""),F=({trigger:e,carId:a,carMake:t,carModel:m,carYear:o})=>{const{toast:d}=s(),[c,p]=N.useState(!1),[h,u]=N.useState(!1),[f,w]=N.useState({firstName:"",lastName:"",email:"",whatsappPhone:""}),[P,_]=N.useState({firstName:"",lastName:"",email:"",whatsappPhone:""}),F=e=>{const{name:a,value:t}=e.target;P[a]&&_(e=>({...e,[a]:""})),w(e=>({...e,[a]:t}))};return l.jsxs(v,{open:c,onOpenChange:p,children:[l.jsx(k,{asChild:!0,children:e}),l.jsxs($,{className:"sm:max-w-md max-h-[90vh] overflow-y-auto mx-4 sm:mx-auto","aria-describedby":"inspection-form-description",onClick:e=>e.stopPropagation(),children:[l.jsxs(q,{className:"pb-4",children:[l.jsxs(C,{className:"flex items-center gap-2 text-lg sm:text-xl",children:[l.jsx(b,{className:"h-5 w-5 text-primary"}),"KÃ«rkesÃ« pÃ«r Inspektim"]}),l.jsx("p",{id:"inspection-form-description",className:"text-sm text-muted-foreground",children:"PlotÃ«soni formularin pÃ«r tÃ« kÃ«rkuar shÃ«rbimin e inspektimit tÃ« makinÃ«s."})]}),l.jsx(r,{className:"border-0 shadow-none",children:l.jsx(i,{className:"px-2 py-4",children:l.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),e.stopPropagation(),!h)if((()=>{const e={firstName:"",lastName:"",email:"",whatsappPhone:""};var a,t;return f.firstName.trim()?f.firstName.trim().length<2&&(e.firstName="First name must be at least 2 characters"):e.firstName="First name is required",f.lastName.trim()?f.lastName.trim().length<2&&(e.lastName="Last name must be at least 2 characters"):e.lastName="Last name is required",f.email.trim()?(a=f.email,/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)||(e.email="Please enter a valid email address")):e.email="Email is required",f.whatsappPhone.trim()?(t=f.whatsappPhone,/^\+?[\d\s\-\(\)]{8,15}$/.test(t)||(e.whatsappPhone="Please enter a valid phone number")):e.whatsappPhone="Phone number is required",_(e),!Object.values(e).some(e=>""!==e)})()){u(!0);try{const e={firstName:M(f.firstName),lastName:M(f.lastName),email:M(f.email.toLowerCase()),whatsappPhone:M(f.whatsappPhone)},r={customer_name:`${e.firstName} ${e.lastName}`,customer_email:e.email,customer_phone:e.whatsappPhone,car_id:a||null,notes:a&&t&&m&&o?`Car: ${o} ${t} ${m}`:"General inspection request",status:"pending"},{data:i,error:n}=await j.from("inspection_requests").insert(r).select();if(n)throw n;try{await j.functions.invoke("send-inspection-notification",{body:{customer_name:`${e.firstName} ${e.lastName}`,customer_email:e.email,customer_phone:e.whatsappPhone,car_make:t,car_model:m,car_year:o}})}catch(s){}const l=t&&m&&o?`ðŸš— Makina: ${o} ${t} ${m}\n`:"",c=`ðŸ”” KÃ«rkesÃ« e Re pÃ«r Inspektim - KORAUTO\n\nðŸ‘¤ Emri: ${e.firstName} ${e.lastName}\nðŸ“§ Email: ${e.email}\nðŸ“± WhatsApp: ${e.whatsappPhone}\n${l}âœ… Klient i ri kÃ«rkon shÃ«rbimin e inspektimit tÃ« makinÃ«s. Kontaktojeni sa mÃ« shpejt!`,h=`https://wa.me/38348181116?text=${encodeURIComponent(c)}`;window.open(h,"_blank"),w({firstName:"",lastName:"",email:"",whatsappPhone:""}),_({firstName:"",lastName:"",email:"",whatsappPhone:""}),p(!1),y(a||void 0,{customer_name:`${e.firstName} ${e.lastName}`,customer_email:e.email,has_car_id:!!a,form_type:a?"specific_car":"general_inquiry"}),d({title:"Request Submitted Successfully",description:"We have received your inspection request and will contact you soon."})}catch(r){let e="There was an error submitting your request. Please try again.";r?.message?.includes("rate")?e="Too many requests. Please wait a moment and try again.":r?.message?.includes("network")&&(e="Network error. Please check your connection and try again."),d({title:"Error",description:e,variant:"destructive"})}finally{u(!1)}}else d({title:"Validation Error",description:"Please fix the errors in the form",variant:"destructive"})},className:"space-y-4 sm:space-y-5",children:l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx(g,{htmlFor:"firstName",children:"First Name"}),l.jsx(x,{id:"firstName",name:"firstName",type:"text",value:f.firstName,onChange:F,required:!0,maxLength:50,className:P.firstName?"border-destructive":""}),P.firstName&&l.jsx("p",{className:"text-sm text-destructive mt-1",children:P.firstName})]}),l.jsxs("div",{children:[l.jsx(g,{htmlFor:"lastName",children:"Last Name"}),l.jsx(x,{id:"lastName",name:"lastName",type:"text",value:f.lastName,onChange:F,required:!0,maxLength:50,className:P.lastName?"border-destructive":""}),P.lastName&&l.jsx("p",{className:"text-sm text-destructive mt-1",children:P.lastName})]}),l.jsxs("div",{children:[l.jsx(g,{htmlFor:"email",children:"Email"}),l.jsx(x,{id:"email",name:"email",type:"email",value:f.email,onChange:F,required:!0,maxLength:100,className:P.email?"border-destructive":""}),P.email&&l.jsx("p",{className:"text-sm text-destructive mt-1",children:P.email})]}),l.jsxs("div",{children:[l.jsx(g,{htmlFor:"whatsappPhone",children:"WhatsApp Phone Number"}),l.jsx(x,{id:"whatsappPhone",name:"whatsappPhone",type:"tel",placeholder:"+355 68 123 4567",value:f.whatsappPhone,onChange:F,required:!0,maxLength:20,className:P.whatsappPhone?"border-destructive":""}),P.whatsappPhone&&l.jsx("p",{className:"text-sm text-destructive mt-1",children:P.whatsappPhone})]}),l.jsx(n,{type:"submit",className:"w-full",disabled:h,children:h?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Submitting..."]}):"DÃ«rgo KÃ«rkesÃ«n"})]})})})})]})]})},L=Object.freeze(Object.defineProperty({__proto__:null,default:F},Symbol.toStringTag,{value:"Module"}));export{v as D,w as F,F as I,b as M,$ as a,L as b};
