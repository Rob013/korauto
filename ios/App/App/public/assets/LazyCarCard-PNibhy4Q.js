import{j as e}from"./ui-5CGx59HE.js";import{r as s}from"./vendor-Ce2S7JN_.js";import{B as t}from"./badge-CtAh7DWu.js";import{a,B as r,d as l,u as i}from"./index-DXJv48IP.js";import{s as o}from"./client-ClhMjqWB.js";import{u as n,C as c,a as m}from"./useImageSwipe-D5MjfpnV.js";import{b as d}from"./router-CrtsEgIx.js";import{C as h}from"./camera-Dgez-INn.js";import{C as u}from"./car-BxrBaIAr.js";import{H as p}from"./heart-j_9DbFLM.js";import{G as x}from"./gauge-C77d0s-O.js";import{S as g}from"./settings-CifkK-3H.js";import{F as f,P as j}from"./palette-CnXSA3iB.js";import{S as b}from"./shield-2CMa0t69.js";const v=({images:s,alt:t,className:l,showArrows:i=!0,showDots:o=!0,onImageChange:d})=>{const{currentIndex:h,containerRef:u,goToNext:p,goToPrevious:x,goToIndex:g,currentImage:f,hasNext:j,hasPrevious:b}=n({images:s,onImageChange:d});return s&&0!==s.length?1===s.length?e.jsx("div",{className:a("w-full h-full relative",l),children:e.jsx("img",{src:s[0],alt:t,className:"w-full h-full object-cover",loading:"lazy"})}):e.jsxs("div",{ref:u,className:a("relative w-full h-full group cursor-pointer",l),children:[e.jsx("img",{src:f,alt:`${t} - Image ${h+1} of ${s.length}`,className:"w-full h-full object-cover transition-opacity duration-300",loading:"lazy"}),i&&s.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"ghost",size:"sm",className:"absolute left-2 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity bg-black/50 hover:bg-black/70 text-white rounded-full w-8 h-8 p-0 hidden sm:flex",onClick:e=>{e.stopPropagation(),x()},disabled:!b&&s.length<=1,children:e.jsx(c,{className:"h-4 w-4"})}),e.jsx(r,{variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity bg-black/50 hover:bg-black/70 text-white rounded-full w-8 h-8 p-0 hidden sm:flex",onClick:e=>{e.stopPropagation(),p()},disabled:!j&&s.length<=1,children:e.jsx(m,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"absolute top-2 right-2 bg-black/50 text-white text-xs px-2 py-1 rounded",children:[h+1,"/",s.length]}),o&&s.length>1&&e.jsx("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 flex gap-1",children:s.map((s,t)=>e.jsx("button",{className:a("w-2 h-2 rounded-full transition-all",t===h?"bg-white":"bg-white/50 hover:bg-white/70"),onClick:e=>{e.stopPropagation(),g(t)}},t))}),e.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 text-white text-xs bg-black/50 px-2 py-1 rounded sm:hidden",children:"Swipe to see more photos"})]}):e.jsx("div",{className:a("w-full h-full bg-muted flex items-center justify-center",l),children:e.jsx("span",{className:"text-muted-foreground",children:"No images available"})})},w=s.memo(({id:a,make:r,model:n,year:c,price:m,image:w,images:N,mileage:y,transmission:k,fuel:S,color:C,lot:_,title:P,status:I,sale_status:D,insurance_v2:z,details:$,is_archived:O,archived_at:T,archive_reason:R})=>{const q=d(),{setCompletePageState:L}=l(),{toast:A}=i(),[F,J]=s.useState(!1),[U,E]=s.useState(null),[B,G]=s.useState(!1),Y=s.useRef(null),H=(()=>{if(O&&T&&"sold"===R)try{const e=new Date(T);return!!isNaN(e.getTime())||((new Date).getTime()-e.getTime())/36e5>24.5}catch(e){return!0}return!1})();s.useEffect(()=>{const e=new IntersectionObserver(([s])=>{s.isIntersecting&&(G(!0),e.disconnect())},{rootMargin:"50px"});return Y.current&&e.observe(Y.current),()=>e.disconnect()},[]),s.useEffect(()=>{let e=!0;return(async()=>{try{const{data:{user:s}}=await o.auth.getUser();if(!e)return;if(E(s),s){const[{data:t},{data:r}]=await Promise.all([o.from("favorite_cars").select("id").eq("user_id",s.id).eq("car_id",a).maybeSingle(),o.from("user_roles").select("role").eq("user_id",s.id).maybeSingle()]);e&&J(!!t)}}catch(s){}})(),()=>{e=!1}},[a]);const K=s.useCallback(async e=>{if(e.stopPropagation(),!U)return A({title:"Login Required",description:"Please login to save favorite cars"}),void q("/auth");try{F?(await o.from("favorite_cars").delete().eq("user_id",U.id).eq("car_id",a),J(!1),A({title:"Removed from favorites",description:"Car removed from your favorites"})):(await o.from("favorite_cars").insert({user_id:U.id,car_id:a,car_make:r,car_model:n,car_year:c,car_price:m,car_image:w}),J(!0),A({title:"Added to favorites",description:"Car saved to your favorites"}))}catch(s){A({title:"Error",description:"Failed to update favorites",variant:"destructive"})}},[U,F,a,r,n,c,m,w,A,q]),M=s.useCallback(e=>{e.preventDefault(),e.stopPropagation();const s=sessionStorage.getItem("mobile-filter-panel-state");L({url:window.location.pathname+window.location.search,scrollPosition:window.scrollY,filterPanelState:!!s&&JSON.parse(s),timestamp:Date.now()}),sessionStorage.setItem("mobile-filter-panel-state",JSON.stringify(!1)),q(`/car/${_}`)},[L,_,q]);return s.useCallback(e=>{e.preventDefault(),e.stopPropagation();const s=sessionStorage.getItem("mobile-filter-panel-state");L({url:window.location.pathname+window.location.search,scrollPosition:window.scrollY,filterPanelState:!!s&&JSON.parse(s),timestamp:Date.now()}),sessionStorage.setItem("mobile-filter-panel-state",JSON.stringify(!1)),q(`/car/${_}`)},[L,_,q]),B?H?null:e.jsxs("div",{ref:Y,className:"glass-card overflow-hidden cursor-pointer group touch-manipulation mobile-card-compact rounded-lg card-touch-effect",onClick:M,children:[e.jsxs("div",{className:"relative h-40 sm:h-52 lg:h-56 bg-muted overflow-hidden",children:[w||N&&N.length>0?e.jsxs(e.Fragment,{children:[e.jsx(v,{images:N&&N.length>0?N:w?[w]:[],alt:`${c} ${r} ${n}`,className:"w-full h-full",showArrows:!0,showDots:N&&N.length>1,onImageChange:e=>{}}),N&&N.length>1&&e.jsxs("div",{className:"absolute top-1 sm:top-2 left-1 sm:left-2 bg-black/70 text-white px-1.5 sm:px-2 py-0.5 sm:py-1 rounded text-xs font-medium flex items-center gap-1",children:[e.jsx(h,{className:"h-3 w-3"}),e.jsx("span",{children:N.length})]})]}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-muted",children:e.jsx(u,{className:"h-12 w-12 sm:h-16 sm:w-16 text-muted-foreground"})}),3===I||"sold"===D?e.jsx("div",{className:"absolute top-1 sm:top-2 right-1 sm:right-2 bg-red-600 text-white px-2 sm:px-3 py-0.5 sm:py-1 rounded text-xs font-bold shadow-lg z-10",children:"SOLD OUT"}):_&&e.jsxs("div",{className:"absolute top-1 sm:top-2 right-1 sm:right-2 bg-primary text-primary-foreground px-1.5 sm:px-2 py-0.5 sm:py-1 rounded text-xs font-semibold",children:["#",_]}),U&&e.jsx("button",{onClick:K,className:"absolute top-1 sm:top-2 left-1 sm:left-2 p-1.5 sm:p-2 bg-black/50 backdrop-blur-sm rounded-full opacity-0 group-hover:opacity-100 transition-opacity z-10",children:e.jsx(p,{className:"h-3 w-3 sm:h-4 sm:w-4 "+(F?"fill-red-500 text-red-500":"text-white")})})]}),e.jsxs("div",{className:"p-2 sm:p-3 lg:p-4",children:[e.jsxs("div",{className:"mb-1.5 sm:mb-2",children:[e.jsxs("h3",{className:"card-title text-sm sm:text-base lg:text-lg font-semibold text-foreground line-clamp-2",children:[c," ",r," ",n]}),P&&P!==`${r} ${n}`&&e.jsx("p",{className:"text-xs text-muted-foreground mb-1 line-clamp-1",children:P})]}),e.jsxs("div",{className:"space-y-0.5 sm:space-y-1 mb-2 sm:mb-3 card-details text-xs",children:[y&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(x,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"truncate",children:y})]}),k&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"capitalize truncate",children:k})]}),S&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"capitalize truncate",children:S})]}),C&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"capitalize truncate",children:C})]})]}),0===z?.accidentCnt&&e.jsx("div",{className:"mb-1.5 sm:mb-2",children:e.jsxs(t,{variant:"secondary",className:"text-xs px-1.5 sm:px-2 py-0",children:[e.jsx(b,{className:"h-2 w-2 mr-1"}),"Clean Record"]})}),e.jsxs("div",{className:"flex flex-col gap-0.5 sm:gap-1 mb-1.5 sm:mb-2",children:[e.jsxs("span",{className:"card-price text-base sm:text-lg lg:text-xl font-bold text-primary",children:["â‚¬",m.toLocaleString()]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Deri ne portin e Durresit"})]}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-xs text-muted-foreground",children:"KORAUTO"})})]})]}):e.jsx("div",{ref:Y,className:"glass-card rounded-lg overflow-hidden h-96",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-52 bg-muted"}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsx("div",{className:"h-5 bg-muted rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-muted rounded w-1/2"}),e.jsx("div",{className:"h-6 bg-muted rounded w-2/3"})]})]})})});w.displayName="LazyCarCard";export{w as L};
