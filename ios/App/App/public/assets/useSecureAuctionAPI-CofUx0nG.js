import{r as e}from"./vendor-Ce2S7JN_.js";import{s as a}from"./client-ClhMjqWB.js";import"./supabase-FBsvvB2P.js";const r=e=>e.toLowerCase().trim().replace(/\s+/g," ").replace(/(\d+)l\b/g,"$1 liter").replace(/(\d+)\s*-\s*(\w+)/g,"$1 $2").replace(/gasoline/g,"petrol").replace(/\bev\b/g,"electric").replace(/\bphev\b/g,"hybrid").replace(/\be-tron\b/g,"electric"),t=(e,a)=>{const t=r(e),i=r(a);if(t===i)return!0;if(t.includes(i)||i.includes(t)){const e=t.length>i.length?t:i,a=t.length>i.length?i:t;return e.length-a.length<=6}const n=[["tdi","diesel"],["tfsi","turbo fsi"],["tsi","turbo"],["cdi","diesel"],["cgi","petrol"]];for(const[r,s]of n)if(t.includes(r)&&i.includes(s)||t.includes(s)&&i.includes(r))return!0;return!1},i=e=>{const a=e.match(/(\d+\.?\d*)/);return a?parseFloat(a[1]):0},n=e=>{const a=(e=>{const a=[],r=new Set;for(let i=0;i<e.length;i++){if(r.has(i))continue;const n=e[i];let s=n.count||0,o=n.label;for(let a=i+1;a<e.length;a++)r.has(a)||t(n.value,e[a].value)&&(s+=e[a].count||0,r.add(a),e[a].label.length>o.length&&(o=e[a].label));a.push({value:n.value,label:o,count:s}),r.add(i)}return a})(e),n=new Map,s=new Map;a.forEach(e=>{const{category:a,priority:t}=(e=>{const a=r(e);return/\b(electric|hybrid|e-tron|phev|ev|e-power|e-quattro)\b/.test(a)?{category:"Electric & Hybrid",priority:1}:/\b(amg|m\d*|rs\d*|s\d*|gt[s]?|gti|r\d*|n\d*|st|type-r|nismo|sti|wrx)\b/.test(a)?{category:"Performance",priority:2}:/\b\d+\.?\d*\s*(tdi|tfsi|tsi|fsi|cdi|cgi|turbo|vtec|vvt|dohc)\b/.test(a)?{category:"Engine Technology",priority:3}:/\b\d+\.?\d*\s*(diesel|petrol|liter|l)\b/.test(a)?{category:"Engine Displacement",priority:4}:/\b(luxury|premium|prestige|executive|business|signature|platinum|diamond|exclusive|elite)\b/.test(a)?{category:"Luxury Trims",priority:5}:/\b(sport|dynamic|design|style|elegance|advance|progressive|comfort|deluxe)\b/.test(a)?{category:"Style Trims",priority:6}:/\b(base|standard|limited|special|edition)\b/.test(a)?{category:"Standard Trims",priority:7}:{category:"Other",priority:8}})(e.value);n.has(a)||(n.set(a,[]),s.set(a,t)),n.get(a).push(e)});const o=[];return n.forEach((e,a)=>{const r=((e,a)=>[...e].sort((e,r)=>{const t=(r.count||0)-(e.count||0);if(0!==t)return t;if("Engine Technology"===a||"Engine Displacement"===a){const a=i(e.value),t=i(r.value);if(a!==t)return t-a}if("Performance"===a){const a=["amg","rs","m","gt","gti","st","r","n","s"],t=a.findIndex(a=>e.value.toLowerCase().includes(a)),i=a.findIndex(e=>r.value.toLowerCase().includes(e));if(-1!==t&&-1!==i)return t-i;if(-1!==t)return-1;if(-1!==i)return 1}return e.label.localeCompare(r.label)}))(e,a),t=s.get(a)||999;o.push({category:a,priority:t,grades:r})}),o.sort((e,a)=>e.priority-a.priority),o},s=e=>{const a=[];return e.forEach((e,r)=>{r>0&&e.grades.length>0&&a.push({value:`separator-${r}`,label:`──── ${e.category} ────`,count:0}),a.push(...e.grades)}),a},o=new Map,d=async(e,a,r)=>{const t=`${e}-${JSON.stringify(a)}`,i=o.get(t);if(i&&Date.now()-i.timestamp<6e4)return i.data;const n=await r();return o.set(t,{data:n,timestamp:Date.now()}),n},c=(e={})=>{const a=[],r=["BMW","Audi","Mercedes-Benz","Toyota","Honda","Hyundai","Kia"],t={BMW:["3 Series","5 Series","X3","X5"],Audi:["A3","A4","A6","Q5"],"Mercedes-Benz":["C-Class","E-Class","GLC"],Toyota:["Camry","RAV4","Corolla"],Honda:["Civic","Accord","CR-V"],Hyundai:["Elantra","Tucson","Santa Fe"],Kia:["Optima","Sportage","Sorento"]};for(let i=1;i<=500;i++){const e=r[i%r.length],n=t[e]||["Model"],s=n[(i+1)%n.length];a.push({id:i,title:`${2015+i%10} ${e} ${s}`,year:2015+i%10,manufacturer:{name:e},model:{name:s},vin:`KMHJ381${String(i).padStart(7,"0")}ABC`,lot_number:`LOT${String(i).padStart(6,"0")}`,lots:[{buy_now:2e4+100*i,images:{normal:[`https://picsum.photos/400/300?random=${i}`]},odometer:{km:5e4+1e3*i}}],fuel:{name:i%3==0?"Petrol":i%3==1?"Diesel":"Hybrid"},transmission:{name:i%2==0?"Automatic":"Manual"},color:{name:["Black","White","Silver","Blue","Red"][i%5]},location:"Seoul"})}return a},m=e=>({BMW:[{id:1001,name:"E90/E91/E92/E93",from_year:2005,to_year:2013,cars_qty:45,manufacturer_id:9,model_id:101},{id:1002,name:"F30/F31/F34/F35",from_year:2012,to_year:2019,cars_qty:67,manufacturer_id:9,model_id:101},{id:1003,name:"G20/G21",from_year:2019,to_year:2024,cars_qty:89,manufacturer_id:9,model_id:101},{id:1004,name:"E60/E61",from_year:2003,to_year:2010,cars_qty:23,manufacturer_id:9,model_id:102},{id:1005,name:"F10/F11/F07/F18",from_year:2010,to_year:2017,cars_qty:56,manufacturer_id:9,model_id:102},{id:1006,name:"G30/G31/G38",from_year:2017,to_year:2024,cars_qty:78,manufacturer_id:9,model_id:102}],Audi:[{id:2001,name:"C7",from_year:2011,to_year:2018,cars_qty:45,manufacturer_id:1,model_id:201},{id:2002,name:"C8",from_year:2018,to_year:2024,cars_qty:67,manufacturer_id:1,model_id:201},{id:2003,name:"B8",from_year:2007,to_year:2015,cars_qty:34,manufacturer_id:1,model_id:202},{id:2004,name:"B9",from_year:2015,to_year:2024,cars_qty:56,manufacturer_id:1,model_id:202}],"Mercedes-Benz":[{id:3001,name:"W204",from_year:2007,to_year:2014,cars_qty:45,manufacturer_id:16,model_id:301},{id:3002,name:"W205",from_year:2014,to_year:2021,cars_qty:67,manufacturer_id:16,model_id:301},{id:3003,name:"W206",from_year:2021,to_year:2024,cars_qty:23,manufacturer_id:16,model_id:301}],Toyota:[{id:4001,name:"XV70",from_year:2018,to_year:2024,cars_qty:45,manufacturer_id:3,model_id:401},{id:4002,name:"XV60",from_year:2012,to_year:2017,cars_qty:34,manufacturer_id:3,model_id:401},{id:4003,name:"E210",from_year:2019,to_year:2024,cars_qty:67,manufacturer_id:3,model_id:402},{id:4004,name:"E170",from_year:2013,to_year:2019,cars_qty:56,manufacturer_id:3,model_id:402},{id:4005,name:"XA50",from_year:2019,to_year:2024,cars_qty:45,manufacturer_id:3,model_id:403},{id:4006,name:"XA40",from_year:2013,to_year:2018,cars_qty:34,manufacturer_id:3,model_id:403}],Honda:[{id:5001,name:"11th Gen",from_year:2022,to_year:2024,cars_qty:34,manufacturer_id:2,model_id:501},{id:5002,name:"10th Gen",from_year:2016,to_year:2021,cars_qty:45,manufacturer_id:2,model_id:501},{id:5003,name:"11th Gen",from_year:2018,to_year:2024,cars_qty:34,manufacturer_id:2,model_id:502},{id:5004,name:"10th Gen",from_year:2013,to_year:2017,cars_qty:23,manufacturer_id:2,model_id:502},{id:5005,name:"6th Gen",from_year:2023,to_year:2024,cars_qty:45,manufacturer_id:2,model_id:503},{id:5006,name:"5th Gen",from_year:2017,to_year:2022,cars_qty:34,manufacturer_id:2,model_id:503}],Hyundai:[{id:6001,name:"7th Gen",from_year:2021,to_year:2024,cars_qty:34,manufacturer_id:7,model_id:601},{id:6002,name:"6th Gen",from_year:2017,to_year:2020,cars_qty:23,manufacturer_id:7,model_id:601},{id:6003,name:"8th Gen",from_year:2020,to_year:2024,cars_qty:34,manufacturer_id:7,model_id:602},{id:6004,name:"7th Gen",from_year:2015,to_year:2019,cars_qty:23,manufacturer_id:7,model_id:602},{id:6005,name:"4th Gen",from_year:2021,to_year:2024,cars_qty:45,manufacturer_id:7,model_id:603},{id:6006,name:"3rd Gen",from_year:2016,to_year:2020,cars_qty:34,manufacturer_id:7,model_id:603}],Kia:[{id:7001,name:"4th Gen",from_year:2021,to_year:2024,cars_qty:34,manufacturer_id:8,model_id:701},{id:7002,name:"3rd Gen",from_year:2016,to_year:2020,cars_qty:23,manufacturer_id:8,model_id:701},{id:7003,name:"3rd Gen",from_year:2019,to_year:2024,cars_qty:23,manufacturer_id:8,model_id:702},{id:7004,name:"2nd Gen",from_year:2014,to_year:2018,cars_qty:18,manufacturer_id:8,model_id:702},{id:7005,name:"5th Gen",from_year:2022,to_year:2024,cars_qty:34,manufacturer_id:8,model_id:703},{id:7006,name:"4th Gen",from_year:2016,to_year:2021,cars_qty:23,manufacturer_id:8,model_id:703}],Nissan:[{id:8001,name:"6th Gen",from_year:2019,to_year:2024,cars_qty:23,manufacturer_id:4,model_id:801},{id:8002,name:"5th Gen",from_year:2013,to_year:2018,cars_qty:18,manufacturer_id:4,model_id:801},{id:8003,name:"8th Gen",from_year:2020,to_year:2024,cars_qty:18,manufacturer_id:4,model_id:802},{id:8004,name:"7th Gen",from_year:2013,to_year:2019,cars_qty:12,manufacturer_id:4,model_id:802},{id:8005,name:"3rd Gen",from_year:2021,to_year:2024,cars_qty:34,manufacturer_id:4,model_id:803},{id:8006,name:"2nd Gen",from_year:2014,to_year:2020,cars_qty:23,manufacturer_id:4,model_id:803}],Ford:[{id:9001,name:"4th Gen",from_year:2019,to_year:2024,cars_qty:23,manufacturer_id:5,model_id:901},{id:9002,name:"3rd Gen",from_year:2012,to_year:2018,cars_qty:18,manufacturer_id:5,model_id:901},{id:9003,name:"2nd Gen",from_year:2013,to_year:2020,cars_qty:18,manufacturer_id:5,model_id:902},{id:9004,name:"1st Gen",from_year:2006,to_year:2012,cars_qty:12,manufacturer_id:5,model_id:902},{id:9005,name:"4th Gen",from_year:2020,to_year:2024,cars_qty:34,manufacturer_id:5,model_id:903},{id:9006,name:"3rd Gen",from_year:2013,to_year:2019,cars_qty:23,manufacturer_id:5,model_id:903}],Chevrolet:[{id:10001,name:"2nd Gen",from_year:2016,to_year:2024,cars_qty:18,manufacturer_id:6,model_id:1001},{id:10002,name:"1st Gen",from_year:2011,to_year:2015,cars_qty:12,manufacturer_id:6,model_id:1001},{id:10003,name:"9th Gen",from_year:2016,to_year:2024,cars_qty:12,manufacturer_id:6,model_id:1002},{id:10004,name:"8th Gen",from_year:2013,to_year:2015,cars_qty:8,manufacturer_id:6,model_id:1002},{id:10005,name:"3rd Gen",from_year:2018,to_year:2024,cars_qty:23,manufacturer_id:6,model_id:1003},{id:10006,name:"2nd Gen",from_year:2010,to_year:2017,cars_qty:18,manufacturer_id:6,model_id:1003}],Volkswagen:[{id:11001,name:"Mk8",from_year:2020,to_year:2024,cars_qty:34,manufacturer_id:147,model_id:1101},{id:11002,name:"Mk7",from_year:2013,to_year:2019,cars_qty:23,manufacturer_id:147,model_id:1101},{id:11003,name:"7th Gen",from_year:2019,to_year:2024,cars_qty:23,manufacturer_id:147,model_id:1102},{id:11004,name:"6th Gen",from_year:2011,to_year:2018,cars_qty:18,manufacturer_id:147,model_id:1102},{id:11005,name:"B8",from_year:2015,to_year:2024,cars_qty:18,manufacturer_id:147,model_id:1103},{id:11006,name:"B7",from_year:2011,to_year:2014,cars_qty:12,manufacturer_id:147,model_id:1103},{id:11007,name:"2nd Gen",from_year:2017,to_year:2024,cars_qty:15,manufacturer_id:147,model_id:1104},{id:11008,name:"1st Gen",from_year:2008,to_year:2016,cars_qty:8,manufacturer_id:147,model_id:1104},{id:11009,name:"1st Gen",from_year:2018,to_year:2024,cars_qty:12,manufacturer_id:147,model_id:1105}],Mazda:[{id:12001,name:"4th Gen",from_year:2019,to_year:2024,cars_qty:18,manufacturer_id:10,model_id:1201},{id:12002,name:"3rd Gen",from_year:2014,to_year:2018,cars_qty:12,manufacturer_id:10,model_id:1201},{id:12003,name:"3rd Gen",from_year:2014,to_year:2024,cars_qty:12,manufacturer_id:10,model_id:1202},{id:12004,name:"2nd Gen",from_year:2009,to_year:2013,cars_qty:8,manufacturer_id:10,model_id:1202},{id:12005,name:"2nd Gen",from_year:2017,to_year:2024,cars_qty:23,manufacturer_id:10,model_id:1203},{id:12006,name:"1st Gen",from_year:2013,to_year:2016,cars_qty:18,manufacturer_id:10,model_id:1203}]}[e]||[]),l=e=>({BMW:[{id:101,name:"3 Series",cars_qty:201},{id:102,name:"5 Series",cars_qty:157},{id:103,name:"7 Series",cars_qty:89},{id:104,name:"X3",cars_qty:145},{id:105,name:"X5",cars_qty:123}],Audi:[{id:201,name:"A6",cars_qty:112},{id:202,name:"A4",cars_qty:98},{id:203,name:"A3",cars_qty:76},{id:204,name:"Q7",cars_qty:45}],"Mercedes-Benz":[{id:301,name:"C-Class",cars_qty:134},{id:302,name:"E-Class",cars_qty:98},{id:303,name:"S-Class",cars_qty:67}],Toyota:[{id:401,name:"Camry",cars_qty:89},{id:402,name:"Corolla",cars_qty:134},{id:403,name:"RAV4",cars_qty:95},{id:404,name:"Prius",cars_qty:67},{id:405,name:"Highlander",cars_qty:45}],Honda:[{id:501,name:"Civic",cars_qty:78},{id:502,name:"Accord",cars_qty:65},{id:503,name:"CR-V",cars_qty:89},{id:504,name:"Pilot",cars_qty:34},{id:505,name:"Fit",cars_qty:23}],Hyundai:[{id:601,name:"Elantra",cars_qty:67},{id:602,name:"Sonata",cars_qty:56},{id:603,name:"Tucson",cars_qty:78},{id:604,name:"Santa Fe",cars_qty:45},{id:605,name:"Genesis G90",cars_qty:23}],Kia:[{id:701,name:"Optima",cars_qty:56},{id:702,name:"Forte",cars_qty:45},{id:703,name:"Sportage",cars_qty:67},{id:704,name:"Sorento",cars_qty:34},{id:705,name:"Stinger",cars_qty:23}],Nissan:[{id:801,name:"Altima",cars_qty:45},{id:802,name:"Sentra",cars_qty:34},{id:803,name:"Rogue",cars_qty:67},{id:804,name:"Murano",cars_qty:23},{id:805,name:"370Z",cars_qty:12}],Ford:[{id:901,name:"Focus",cars_qty:45},{id:902,name:"Fusion",cars_qty:34},{id:903,name:"Escape",cars_qty:56},{id:904,name:"Explorer",cars_qty:23},{id:905,name:"Mustang",cars_qty:18}],Chevrolet:[{id:1001,name:"Cruze",cars_qty:34},{id:1002,name:"Malibu",cars_qty:23},{id:1003,name:"Equinox",cars_qty:45},{id:1004,name:"Tahoe",cars_qty:12},{id:1005,name:"Camaro",cars_qty:8}],Volkswagen:[{id:1101,name:"Golf",cars_qty:67},{id:1102,name:"Jetta",cars_qty:45},{id:1103,name:"Passat",cars_qty:34},{id:1104,name:"Tiguan",cars_qty:23},{id:1105,name:"Atlas",cars_qty:12}],Mazda:[{id:1201,name:"Mazda3",cars_qty:34},{id:1202,name:"Mazda6",cars_qty:23},{id:1203,name:"CX-5",cars_qty:45},{id:1204,name:"CX-9",cars_qty:12},{id:1205,name:"MX-5",cars_qty:8}]}[e]||[]),_=()=>[{id:9,name:"BMW",cars_qty:245},{id:16,name:"Mercedes-Benz",cars_qty:189},{id:1,name:"Audi",cars_qty:167},{id:147,name:"Volkswagen",cars_qty:134},{id:13,name:"Porsche",cars_qty:27},{id:22,name:"Opel",cars_qty:45},{id:7,name:"Hyundai",cars_qty:112},{id:8,name:"Kia",cars_qty:95},{id:19,name:"Genesis",cars_qty:12},{id:3,name:"Toyota",cars_qty:156},{id:2,name:"Honda",cars_qty:98},{id:4,name:"Nissan",cars_qty:87},{id:10,name:"Mazda",cars_qty:43},{id:11,name:"Subaru",cars_qty:29},{id:12,name:"Lexus",cars_qty:38},{id:17,name:"Infiniti",cars_qty:18},{id:18,name:"Acura",cars_qty:15},{id:23,name:"Mitsubishi",cars_qty:25},{id:5,name:"Ford",cars_qty:76},{id:6,name:"Chevrolet",cars_qty:54},{id:24,name:"Cadillac",cars_qty:18},{id:25,name:"GMC",cars_qty:15},{id:20,name:"Tesla",cars_qty:8},{id:26,name:"Chrysler",cars_qty:12},{id:27,name:"Jeep",cars_qty:22},{id:28,name:"Dodge",cars_qty:16},{id:14,name:"Land Rover",cars_qty:22},{id:21,name:"Jaguar",cars_qty:9},{id:15,name:"Volvo",cars_qty:31},{id:29,name:"Ferrari",cars_qty:3},{id:30,name:"Lamborghini",cars_qty:2},{id:31,name:"Maserati",cars_qty:4},{id:32,name:"Bentley",cars_qty:2},{id:33,name:"Rolls-Royce",cars_qty:1},{id:34,name:"Aston Martin",cars_qty:2},{id:35,name:"McLaren",cars_qty:1},{id:43,name:"Mini",cars_qty:14},{id:36,name:"Peugeot",cars_qty:28},{id:37,name:"Renault",cars_qty:35},{id:38,name:"Citroën",cars_qty:18},{id:39,name:"Fiat",cars_qty:22},{id:40,name:"Alfa Romeo",cars_qty:11},{id:41,name:"Skoda",cars_qty:24},{id:42,name:"Seat",cars_qty:16}].map(e=>({id:e.id,name:e.name,cars_qty:e.cars_qty,car_count:e.cars_qty})),y=()=>{const[r,t]=e.useState([]),[i,o]=e.useState(!1),[y,u]=e.useState(null),[f,g]=e.useState(1),[h,p]=e.useState(0),[q,b]=e.useState(!1),[v,w]=e.useState(0),[C,A]=e.useState({}),[E,G]=e.useState({}),[S,M]=e.useState({}),L=e=>new Promise(a=>setTimeout(a,e)),x=async(e,r={},t)=>{try{const i=Date.now();i-v<50&&await L(50-(i-v)),w(Date.now());const{data:n,error:s}=await a.functions.invoke("secure-cars-api",{body:{endpoint:e,filters:r,carId:t}});if(s){let e="Failed to send request to the server.";throw s.message?.includes("timeout")?e="Request timed out. Please try again.":s.message?.includes("network")?e="Network error. Please check your connection.":s.message?.includes("401")||s.message?.includes("unauthorized")?e="Authentication error. Please refresh the page.":s.message?.includes("404")?e="No data found for your search criteria.":(s.message?.includes("429")||s.message?.includes("rate limit"))&&(e="Too many requests. Please wait a moment and try again."),new Error(e)}if(n?.error){if(n.retryAfter)throw await L(n.retryAfter),new Error("RATE_LIMITED");const e=n.error||"An error occurred while fetching data";throw new Error(e)}return n}catch(i){if(i instanceof Error&&i.message&&!i.message.includes("Error:"))throw i;throw new Error("Unable to connect to the server. Please check your internet connection and try again.")}},$=e.useCallback(async(e=1,a=C,r=!0)=>{r&&(A(a),o(!0),1===e&&g(1)),u(null);try{const i={...a,page:e.toString(),per_page:a.per_page||"50",simple_paginate:"0"},n=a.grade_iaai,s=a.trim_level;delete i.grade_iaai,delete i.trim_level;const o=await x("cars",i);let d=o.data||[];n&&"all"!==n&&(d=d.filter(e=>!(!e.lots||!Array.isArray(e.lots))&&e.lots.some(a=>!!(a.grade_iaai&&a.grade_iaai.trim()===n||a.details&&a.details.badge&&a.details.badge.trim()===n||e.engine&&e.engine.name&&e.engine.name.trim()===n||e.title&&e.title.toLowerCase().includes(n.toLowerCase()))))),s&&"all"!==s&&(d=d.filter(e=>!!(e.lots&&Array.isArray(e.lots)&&e.lots.some(e=>!!(e.details&&e.details.badge&&e.details.badge.toLowerCase().includes(s.toLowerCase()))||!(!e.grade_iaai||!e.grade_iaai.toLowerCase().includes(s.toLowerCase()))))||!(!e.title||!e.title.toLowerCase().includes(s.toLowerCase())))),p(o.meta?.total||0),b(e<(o.meta?.last_page||1)),r||1===e?(t(d),g(e)):(t(e=>[...e,...d]),g(e))}catch(i){if("RATE_LIMITED"===i.message)try{return await L(2e3),$(e,a,r)}catch(n){}if(a.manufacturer_id&&"all"!==a.manufacturer_id&&""!==a.manufacturer_id&&void 0!==a.manufacturer_id&&null!==a.manufacturer_id)return u("Failed to load cars for the selected brand. Please try again."),t([]),p(0),void b(!1);const s=c(a);if(0===s.length)return u("Failed to load cars. Please try again."),t([]),p(0),void b(!1);const o=parseInt(a.per_page||"50"),d=(e-1)*o,m=d+o,l=s.slice(d,m);p(s.length),b(m<s.length),r||1===e?(t(l),g(e)):(t(e=>[...e,...l]),g(e)),u(null),r||1===e?(t(l),g(1)):(t(e=>[...e,...l]),g(e)),u(null)}finally{o(!1)}},[C]),T=async()=>{try{let e=(await d("manufacturers/cars",{per_page:"1000",simple_paginate:"0"},()=>x("manufacturers/cars",{per_page:"1000",simple_paginate:"0"}))).data||[];return e=e.length>0?e.map(e=>({id:e.id,name:e.name,cars_qty:e.cars_qty||e.car_count||0,car_count:e.car_count||e.cars_qty||0})):_(),e}catch(e){return _()}},F=async e=>{try{let a=((await d(`models/${e}/cars`,{per_page:"1000",simple_paginate:"0"},()=>x(`models/${e}/cars`,{per_page:"1000",simple_paginate:"0"}))).data||[]).filter(e=>e&&e.id&&e.name);return a=a.filter(a=>a.manufacturer_id?.toString()===e||a.manufacturer?.id?.toString()===e),a.sort((e,a)=>e.name.localeCompare(a.name)),a}catch(a){try{const a=(await T()).find(a=>a.id.toString()===e);if(a)return l(a.name)}catch(r){}return[]}},I=async e=>{try{let r=[];try{const a=await x(`generations/${e}`,{});a.data&&Array.isArray(a.data)&&(r=a.data.filter(e=>e&&e.id&&e.name))}catch(a){}if(r.length>0&&r.some(e=>e.from_year||e.to_year))return r.sort((e,a)=>e.name.localeCompare(a.name));const t=parseInt(e);let i=[];const n=["BMW","Audi","Mercedes-Benz","Toyota","Honda","Hyundai","Kia","Nissan","Ford","Chevrolet","Volkswagen","Mazda"];for(const e of n){const a=m(e).filter(e=>e.model_id===t);if(a.length>0){i=a;break}}0===i.length&&(i=[{id:1e3*parseInt(e)+1,name:"1st Generation",from_year:2010,to_year:2018,cars_qty:10,manufacturer_id:void 0,model_id:t},{id:1e3*parseInt(e)+2,name:"2nd Generation",from_year:2018,to_year:2024,cars_qty:15,manufacturer_id:void 0,model_id:t}]);const s=i.filter(e=>e&&e.id&&e.name);return s.sort((e,a)=>e.name.localeCompare(a.name)),s}catch(a){const r=parseInt(e);return[{id:1e3*r+1,name:"1st Generation",from_year:2010,to_year:2018,cars_qty:5,manufacturer_id:void 0,model_id:r},{id:1e3*r+2,name:"2nd Generation",from_year:2018,to_year:2024,cars_qty:8,manufacturer_id:void 0,model_id:r}]}},P=()=>{const e=new Set,a=[/\b(premium|luxury|sport|exclusive|elite|prestige|comfort|deluxe|base|standard|limited|special|edition)\b/gi,/\b(executive|business|design|style|elegance|dynamic|advance|progressive|sophisticated)\b/gi,/\b(ultimate|signature|platinum|diamond|titanium|carbon|black|white|red|blue)\b/gi];return r.forEach(r=>{if(r.lots&&Array.isArray(r.lots)&&r.lots.forEach(r=>{if(r.details&&r.details.badge&&"string"==typeof r.details.badge){const t=r.details.badge.toLowerCase();a.forEach(a=>{const r=t.match(a);r&&r.forEach(a=>{const r=a.trim();r.length>2&&e.add(r.charAt(0).toUpperCase()+r.slice(1))})})}}),r.title&&"string"==typeof r.title){const t=r.title.toLowerCase();a.forEach(a=>{const r=t.match(a);r&&r.forEach(a=>{const r=a.trim();r.length>2&&e.add(r.charAt(0).toUpperCase()+r.slice(1))})})}}),e.size>0?Array.from(e).sort().map(e=>({value:e,label:e})):[{value:"Premium",label:"Premium"},{value:"Prestige",label:"Prestige"},{value:"Comfort",label:"Comfort"},{value:"Luxury",label:"Luxury"},{value:"Sport",label:"Sport"},{value:"Executive",label:"Executive"},{value:"Business",label:"Business"},{value:"Exclusive",label:"Exclusive"},{value:"Elite",label:"Elite"},{value:"Deluxe",label:"Deluxe"},{value:"Standard",label:"Standard"},{value:"Base",label:"Base"},{value:"Limited",label:"Limited"},{value:"Special",label:"Special Edition"},{value:"Design",label:"Design"},{value:"Style",label:"Style"},{value:"Elegance",label:"Elegance"},{value:"Dynamic",label:"Dynamic"},{value:"Advance",label:"Advance"},{value:"Progressive",label:"Progressive"}]},B=async(e,a,r,t)=>{try{const i=t||`${e||""}-${a||""}-${r||""}`,o={per_page:"50"};e&&(o.manufacturer_id=e),a&&(o.model_id=a),r&&(o.generation_id=r);const d=(await x("cars",o)).data||[];if(0===d.length){const a=D(e);return G(e=>({...e,[i]:a})),a}const c=new Map;d.forEach(e=>{if(e.lots&&Array.isArray(e.lots)&&e.lots.forEach(e=>{if(e.grade_iaai&&"string"==typeof e.grade_iaai&&e.grade_iaai.trim()){const a=e.grade_iaai.trim();c.set(a,(c.get(a)||0)+1)}}),e.lots&&Array.isArray(e.lots)&&e.lots.forEach(e=>{if(e.details&&e.details.badge&&"string"==typeof e.details.badge&&e.details.badge.trim()){const a=e.details.badge.trim();c.set(a,(c.get(a)||0)+1)}}),e.engine&&e.engine.name&&"string"==typeof e.engine.name&&e.engine.name.trim()){const a=e.engine.name.trim();a.length>2&&!/^\d+\.?\d*$/.test(a)&&!/^[A-Z]{2,4}$/.test(a)&&/^(?:\d+\s*)?(?:TDI|TFSI|TSI|FSI|CDI|CGI|AMG|d|i|e|h|hybrid|electric|e-tron|phev)/i.test(a)&&c.set(a,(c.get(a)||0)+1)}if(e.title&&"string"==typeof e.title){const a=e.title.toLowerCase();[/\b(\d+\s*(?:tdi|tfsi|tsi|fsi|cdi|cgi))\b/gi,/\b(amg|m|rs|s|gt|gts|gti|r|n|st)\b/gi,/\b(hybrid|electric|e-tron|phev|ev)\b/gi,/\b(premium|luxury|sport|exclusive|elite|prestige|comfort|deluxe)\b/gi].forEach(e=>{const r=a.match(e);r&&r.forEach(e=>{const a=e.trim();a&&a.length>0&&c.set(a,(c.get(a)||0)+1)})})}});const m=new Set(["unknown","n/a","none","","null","undefined","basic","standard"]),l=e=>{const a=e.toLowerCase();return!m.has(a)&&(!/^[A-Z]{2,4}$/i.test(e)&&(!/^[A-Z]{2,4}\s+[A-Z]{2,4}$/i.test(e)&&(!/^\d+\.?\d*$/.test(e)&&[/tdi|tfsi|tsi|fsi|cdi|cgi/i,/amg|m|rs|s|gt|gts|gti|r|n|st/i,/hybrid|electric|e-tron|phev|ev/i,/premium|luxury|sport|exclusive|elite|prestige|comfort|deluxe/i,/\d+\s*(tdi|tfsi|tsi|fsi|cdi|cgi)/i].some(a=>a.test(e)))))};Array.from(c.keys()).filter(e=>!l(e)).length;const _=Array.from(c.entries()).filter(([e])=>l(e)).map(([e,a])=>({value:e,label:e,count:a})),y=n(_),u=s(y);if(0===u.length){const a=D(e),r=n(a);return s(r)}const f=u;return G(e=>({...e,[i]:f})),f}catch(i){const o=D(),d=n(o),c=s(d),m=t||`${e||""}-${a||""}-${r||""}`;return G(e=>({...e,[m]:c})),c}},D=e=>{const a=new Set;return r.forEach(e=>{if(e.lots&&Array.isArray(e.lots)&&e.lots.forEach(e=>{e.grade_iaai&&"string"==typeof e.grade_iaai&&e.grade_iaai.trim()&&a.add(e.grade_iaai.trim())}),e.lots&&Array.isArray(e.lots)&&e.lots.forEach(e=>{e.details&&e.details.badge&&"string"==typeof e.details.badge&&e.details.badge.trim()&&a.add(e.details.badge.trim())}),e.engine&&e.engine.name&&"string"==typeof e.engine.name&&e.engine.name.trim()){const r=e.engine.name.trim();r.length>2&&!/^\d+\.?\d*$/.test(r)&&!/^[A-Z]{2,4}$/.test(r)&&/^(?:\d+\s*)?(?:TDI|TFSI|TSI|FSI|CDI|CGI|AMG|d|i|e|h|hybrid|electric|e-tron|phev)/i.test(r)&&a.add(r)}}),a.size>0?Array.from(a).sort().map(e=>({value:e,label:e})):[{value:"premium",label:"Premium"},{value:"luxury",label:"Luxury"},{value:"sport",label:"Sport"},{value:"exclusive",label:"Exclusive"},{value:"elite",label:"Elite"},{value:"prestige",label:"Prestige"},{value:"comfort",label:"Comfort"},{value:"deluxe",label:"Deluxe"},{value:"hybrid",label:"Hybrid"},{value:"electric",label:"Electric"}]},k=async(e=C)=>{try{const a={...e,page:void 0,per_page:"9999",simple_paginate:"0"},r=e.grade_iaai,t=e.trim_level;delete a.grade_iaai,delete a.trim_level;let i=(await x("cars",a)).data||[];return r&&"all"!==r&&(i=i.filter(e=>!(!e.lots||!Array.isArray(e.lots))&&e.lots.some(a=>!!(a.grade_iaai&&a.grade_iaai.trim()===r||a.details&&a.details.badge&&a.details.badge.trim()===r||e.engine&&e.engine.name&&e.engine.name.trim()===r||e.title&&e.title.toLowerCase().includes(r.toLowerCase()))))),t&&"all"!==t&&(i=i.filter(e=>!!(e.lots&&Array.isArray(e.lots)&&e.lots.some(e=>!!(e.details&&e.details.badge&&e.details.badge.toLowerCase().includes(t.toLowerCase()))||!(!e.grade_iaai||!e.grade_iaai.toLowerCase().includes(t.toLowerCase()))))||!(!e.title||!e.title.toLowerCase().includes(t.toLowerCase())))),i}catch(a){if("RATE_LIMITED"===a.message)try{return await L(2e3),k(e)}catch(r){}return e.manufacturer_id&&"all"!==e.manufacturer_id&&""!==e.manufacturer_id&&void 0!==e.manufacturer_id&&e.manufacturer_id,[]}};return{cars:r,setCars:t,loading:i,error:y,currentPage:f,totalCount:h,setTotalCount:p,hasMorePages:q,fetchCars:$,fetchAllCars:k,filters:C,setFilters:A,fetchManufacturers:T,fetchModels:F,fetchGenerations:I,fetchAllGenerationsForManufacturer:async e=>{try{const r=await F(e),t=[],i=new Map;for(const e of r)try{(await I(e.id.toString())).forEach(e=>{i.has(e.id)||(i.set(e.id,e),t.push(e))})}catch(a){}return(await Promise.all(t.map(async r=>{try{const a=await x("cars",{manufacturer_id:e,generation_id:r.id.toString(),per_page:"1",simple_paginate:"1"}),t=a.meta?.total||0;return{...r,car_count:t,cars_qty:t}}catch(a){return{...r,cars_qty:r.car_count||0}}}))).sort((e,a)=>e.name.localeCompare(a.name))}catch(a){return[]}},getCategoryCount:async e=>{try{const a=await x("cars",{...e,per_page:"1",simple_paginate:"1"});return a.meta?.total||0}catch(a){return 0}},fetchCarById:async e=>{try{return(await x("cars",{},e)).data||null}catch(a){return null}},fetchCarCounts:async(e={})=>{try{const a={...e,per_page:"1",simple_paginate:"1"},r=await x("cars",a);return{total:r.meta?.total||0}}catch(a){return{total:0}}},fetchFilterCounts:async(e={},a=[])=>({manufacturers:{},models:{},generations:{},colors:{},fuelTypes:{},transmissions:{},years:{}}),fetchKoreaDuplicates:async(e=10,a=1e3)=>{try{const r={minutes:e.toString(),per_page:a.toString()};return(await x("korea-duplicates",r)).data||[]}catch(r){return[]}},fetchGrades:async(e,a,r)=>{const t=`${e||""}-${a||""}-${r||""}`;if(!a&&!r&&e){const i=D(),o=n(i),d=s(o);return setTimeout(()=>{E[t]||B(e,a,r,t)},0),d}return E[t]?E[t]:B(e,a,r,t)},fetchTrimLevels:async(e,a,r)=>{const t=`trim_${e||""}-${a||""}-${r||""}`;if(S[t])return S[t];try{const i={per_page:"100"};e&&(i.manufacturer_id=e),a&&(i.model_id=a),r&&(i.generation_id=r);const n=(await x("cars",i)).data||[];if(0===n.length){const e=P();return M(a=>({...a,[t]:e})),e}const s=new Map,o=[/\b(premium|luxury|sport|exclusive|elite|prestige|comfort|deluxe|base|standard|limited|special|edition)\b/gi,/\b(executive|business|design|style|elegance|dynamic|advance|progressive|sophisticated)\b/gi,/\b(ultimate|signature|platinum|diamond|titanium|carbon|black|white|red|blue)\b/gi];n.forEach(e=>{if(e.lots&&Array.isArray(e.lots)&&e.lots.forEach(e=>{if(e.details&&e.details.badge&&"string"==typeof e.details.badge&&e.details.badge.trim()){const a=e.details.badge.trim();o.forEach(e=>{const r=a.toLowerCase().match(e);r&&r.forEach(e=>{const a=e.trim().toLowerCase();if(a.length>2){const e=a.charAt(0).toUpperCase()+a.slice(1);s.set(e,(s.get(e)||0)+1)}})})}}),e.lots&&Array.isArray(e.lots)&&e.lots.forEach(e=>{if(e.grade_iaai&&"string"==typeof e.grade_iaai&&e.grade_iaai.trim()){const a=e.grade_iaai.trim();o.forEach(e=>{const r=a.toLowerCase().match(e);r&&r.forEach(e=>{const a=e.trim().toLowerCase();if(a.length>2&&!/^[A-Z]{2,4}$/i.test(a)&&!/^\d+\.?\d*$/.test(a)){const e=a.charAt(0).toUpperCase()+a.slice(1);s.set(e,(s.get(e)||0)+1)}})})}}),e.title&&"string"==typeof e.title){const a=e.title.toLowerCase();o.forEach(e=>{const r=a.match(e);r&&r.forEach(e=>{const a=e.trim().toLowerCase();if(a.length>2){const e=a.charAt(0).toUpperCase()+a.slice(1);s.set(e,(s.get(e)||0)+1)}})})}});const d=Array.from(s.entries()).map(([e,a])=>({value:e,label:e,count:a})).sort((e,a)=>a.count-e.count);if(0===d.length){const e=P();return M(a=>({...a,[t]:e})),e}const c=d;return M(e=>({...e,[t]:c})),c}catch(i){const e=P();return M(a=>({...a,[t]:e})),e}},loadMore:async()=>{if(q&&!i){o(!0);try{await $(f+1,C,!1)}catch(e){u(e instanceof Error?e.message:"Failed to load more cars")}finally{o(!1)}}}}};export{c as createFallbackCars,m as createFallbackGenerations,_ as createFallbackManufacturers,l as createFallbackModels,y as useSecureAuctionAPI};
