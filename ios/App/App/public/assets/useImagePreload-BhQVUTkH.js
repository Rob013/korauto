import{r as e}from"./vendor-Ce2S7JN_.js";import{g as r,p as t,h as n}from"./index-DXJv48IP.js";const s=new Map,o=(o,i={})=>{const{priority:a=!1,quality:c=80,width:u=300,enableLazyLoad:d=!0,enableProgressiveLoad:l=!0}=i,[f,v]=e.useState(!1),[m,L]=e.useState(!1),[E,g]=e.useState(!1),p=e.useRef(null),h=e.useRef(null),w=e.useMemo(()=>o?r(o,u,c):"",[o,u,c]);return e.useEffect(()=>{if(w)return s.has(w)?(v(!0),void L(!1)):void(a&&t(w,"image"));v(!0)},[w,a]),e.useEffect(()=>{if(!w||!d||a||s.has(w))return;const e=()=>{g(!0),L(!1);const e=new Image;if(l){const e=r(o,u,20),t=new Image;t.onload=()=>{p.current&&(p.current.src=e,p.current.style.filter="blur(5px)")},t.src=e}const t=()=>{v(!0),g(!1),L(!1),s.set(w,!0),p.current&&(p.current.src=w,p.current.style.filter="none",p.current.style.transition="filter 0.3s ease")},n=()=>{L(!0),g(!1),v(!1),s.set(w,!1)};return e.addEventListener("load",t),e.addEventListener("error",n),e.src=w,()=>{e.removeEventListener("load",t),e.removeEventListener("error",n)}};return"IntersectionObserver"in window?(h.current=n(r=>{r.isIntersecting&&(e(),h.current?.disconnect())},{rootMargin:"50px"}),p.current&&h.current.observe(p.current)):e(),()=>{h.current?.disconnect()}},[w,d,a,o,u,l]),e.useEffect(()=>{if(!w||!a&&d||s.has(w))return;g(!0),L(!1);const e=new Image,r=()=>{v(!0),g(!1),L(!1),s.set(w,!0)},t=()=>{L(!0),g(!1),v(!1),s.set(w,!1)};return e.addEventListener("load",r),e.addEventListener("error",t),e.src=w,()=>{e.removeEventListener("load",r),e.removeEventListener("error",t)}},[w,a,d]),{imgRef:p,isLoaded:f,isError:m,isLoading:E,optimizedSrc:w||o||"",shouldShowPlaceholder:E||!f&&!m}};export{o as u};
