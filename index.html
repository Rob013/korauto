<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>KORAUTO - Premium Cars from South Korea</title>
    <meta name="description" content="Find your perfect car from South Korea with best price and quality. Professional car inspection services and premium vehicle imports.">
    <meta name="author" content="KORAUTO" />
    
    <!-- Performance Optimization -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://iyezkczshcgbcgpswpyg.supabase.co">
    <link rel="dns-prefetch" href="https://korautoks.com">
    
    <!-- Preload critical resources -->
    <link rel="modulepreload" href="/src/main.tsx">
    <style>
      /* Critical CSS - Prevent FOUC */
      html { font-family: system-ui, sans-serif; }
      body { margin: 0; background: #ffffff; }
      #root { min-height: 100vh; }
      .dark body { background: #0a0a0a; }
      
      /* Mobile fallback */
      @media (max-width: 768px) {
        #root {
          min-height: 100vh;
          display: flex;
          flex-direction: column;
        }
        
        .mobile-fallback {
          display: none;
          padding: 20px;
          text-align: center;
          background: #f3f4f6;
          color: #374151;
        }
        
        .mobile-fallback.show {
          display: block;
        }
      }
    </style>
    
    <!-- Favicon and Icons -->
    <link rel="icon" type="image/x-icon" href="https://storage.googleapis.com/gpt-engineer-file-uploads/YQL55BAx4ad4To5BuJ6CPGn22603/uploads/1757847506537-f5e4fe22-b482-4333-91fd-12132af7d102.jpeg">
    <link rel="apple-touch-icon" href="/lovable-uploads/7a3e2aa4-2a3b-4320-b33c-72d3d7721cfd.png">
    <link rel="shortcut icon" href="/lovable-uploads/7a3e2aa4-2a3b-4320-b33c-72d3d7721cfd.png">
    <meta name="theme-color" content="#1f2937">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- iOS PWA -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="KORAUTO">
    
    <!-- Android PWA -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Open Graph / Facebook -->
    <meta property="og:title" content="KORAUTO - Premium Cars from South Korea" />
    <meta property="og:description" content="Find your perfect car from South Korea with best price and quality. Professional car inspection services and premium vehicle imports." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://korautoks.com" />
    <meta property="og:image" content="https://storage.googleapis.com/gpt-engineer-file-uploads/YQL55BAx4ad4To5BuJ6CPGn22603/social-images/social-1757832941689-Image.png">
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@korauto" />
    <meta name="twitter:title" content="KORAUTO - Premium Cars from South Korea" />
    <meta name="twitter:description" content="Find your perfect car from South Korea with best price and quality. Professional car inspection services and premium vehicle imports." />
    <meta name="twitter:image" content="https://storage.googleapis.com/gpt-engineer-file-uploads/YQL55BAx4ad4To5BuJ6CPGn22603/social-images/social-1757832941689-Image.png">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EK3E1KLL6V"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-EK3E1KLL6V');
    </script>

    <!-- ES Module compatibility check and fallback -->
    <script>
      // Check for ES module support and provide better error handling
      (function() {
        try {
          // Basic ES6 feature check
          new Function('import("")');
        } catch (e) {
          // Browser doesn't support dynamic imports, show error
          document.addEventListener('DOMContentLoaded', function() {
            document.body.innerHTML = '<div style="padding: 20px; font-family: Arial, sans-serif; text-align: center;"><h2>Browser Not Supported</h2><p>This application requires a modern browser that supports ES modules. Please update your browser to the latest version.</p><p>Supported browsers: Chrome 63+, Firefox 60+, Safari 11.1+, Edge 79+</p></div>';
          });
          return;
        }

        // Handle module loading errors
        window.addEventListener('error', function(e) {
          if (e.message && e.message.includes('module')) {
            console.error('Module loading error:', e);
            // Don't replace content immediately, wait a bit to see if it recovers
            setTimeout(function() {
              if (!document.querySelector('#root > *')) {
                document.body.innerHTML = '<div style="padding: 20px; font-family: Arial, sans-serif; text-align: center;"><h2>Loading Error</h2><p>There was an error loading the application. Please refresh the page.</p><button onclick="location.reload()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Refresh Page</button></div>';
              }
            }, 5000);
          }
        });
      })();
    </script>

    <!-- Smartsupp Live Chat script -->
    <script type="text/javascript">
    var _smartsupp = _smartsupp || {};
    _smartsupp.key = 'b946031b416bd52d6cebdf0f507bfa4dd021e21f';
    _smartsupp.options = {
      visible: true,
      position: 'bottom-right',
      zIndex: 2147483647
    };
    
    window.smartsupp||(function(d) {
      var s,c,o=smartsupp=function(){ o._.push(arguments)};o._=[];
      s=d.getElementsByTagName('script')[0];c=d.createElement('script');
      c.type='text/javascript';c.charset='utf-8';c.async=true;
      c.src='https://www.smartsuppchat.com/loader.js?';s.parentNode.insertBefore(c,s);
    })(document);
    
    // Fallback: Create a visible chat widget if Smartsupp doesn't load
    setTimeout(function() {
      if (!document.querySelector('#chat-application') && !document.querySelector('[data-smartsupp-widget]')) {
        console.log('‚ö†Ô∏è Smartsupp not loaded, creating fallback chat widget');
        var fallbackChat = document.createElement('div');
        fallbackChat.id = 'chat-application';
        fallbackChat.innerHTML = '<div style="position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; background: #007bff; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 2147483647; box-shadow: 0 4px 12px rgba(0,0,0,0.3);"><svg width="24" height="24" fill="white" viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg></div>';
        document.body.appendChild(fallbackChat);
        console.log('‚úÖ Fallback chat widget created');
      }
    }, 10000);
    </script>

    <!-- Force Smartsupp positioning script -->
    <script type="text/javascript">
    (function() {
      let debugCount = 0;
      
      function forceSmartsuppPositioning() {
        debugCount++;
        console.log('üîç Smartsupp positioning check #' + debugCount);
        
        // Find all possible Smartsupp elements
        const selectors = [
          '#chat-application',
          '[data-smartsupp-widget]',
          '.smartsupp-widget',
          'iframe[src*="smartsupp"]',
          'iframe[src*="smartsuppchat"]',
          'div[class*="smartsupp"]',
          'div[id*="smartsupp"]',
          'body > div:last-child'
        ];

        let foundElements = 0;
        
        selectors.forEach(selector => {
          const elements = document.querySelectorAll(selector);
          if (elements.length > 0) {
            console.log('‚úÖ Found elements with selector:', selector, elements.length);
            foundElements += elements.length;
          }
          elements.forEach(element => {
            if (element && element.style) {
              element.style.setProperty('position', 'fixed', 'important');
              element.style.setProperty('bottom', '20px', 'important');
              element.style.setProperty('right', '20px', 'important');
              element.style.setProperty('top', 'auto', 'important');
              element.style.setProperty('left', 'auto', 'important');
              element.style.setProperty('z-index', '2147483647', 'important');
              element.style.setProperty('transform', 'none', 'important');
              element.style.setProperty('margin', '0', 'important');
              element.style.setProperty('padding', '0', 'important');
              console.log('üéØ Applied positioning to:', element);
            }
          });
        });

        // Check all divs for Smartsupp characteristics
        const allDivs = document.querySelectorAll('div');
        let smartsuppDivs = 0;
        
        allDivs.forEach(div => {
          if (div.id?.includes('smartsupp') || 
              div.className?.includes('smartsupp') ||
              div.style.position === 'fixed' ||
              div.style.zIndex === '2147483647' ||
              div.querySelector('iframe[src*="smartsupp"]')) {
            smartsuppDivs++;
            div.style.setProperty('position', 'fixed', 'important');
            div.style.setProperty('bottom', '20px', 'important');
            div.style.setProperty('right', '20px', 'important');
            div.style.setProperty('top', 'auto', 'important');
            div.style.setProperty('left', 'auto', 'important');
            div.style.setProperty('z-index', '2147483647', 'important');
            console.log('üéØ Applied positioning to div:', div);
          }
        });

        // Check iframes
        const iframes = document.querySelectorAll('iframe');
        let smartsuppIframes = 0;
        iframes.forEach(iframe => {
          if (iframe.src?.includes('smartsupp') || iframe.src?.includes('smartsuppchat')) {
            smartsuppIframes++;
            iframe.style.setProperty('position', 'fixed', 'important');
            iframe.style.setProperty('bottom', '20px', 'important');
            iframe.style.setProperty('right', '20px', 'important');
            iframe.style.setProperty('top', 'auto', 'important');
            iframe.style.setProperty('left', 'auto', 'important');
            iframe.style.setProperty('z-index', '2147483647', 'important');
            console.log('üéØ Applied positioning to iframe:', iframe);
          }
        });

        console.log('üìä Found elements:', {
          selectors: foundElements,
          smartsuppDivs: smartsuppDivs,
          smartsuppIframes: smartsuppIframes,
          totalDivs: allDivs.length,
          totalIframes: iframes.length
        });

        // Check if Smartsupp is loaded
        if (window.smartsupp) {
          console.log('‚úÖ Smartsupp object exists:', window.smartsupp);
        } else {
          console.log('‚ùå Smartsupp object not found');
        }
      }

      // Run immediately
      forceSmartsuppPositioning();

      // Run on DOM ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', forceSmartsuppPositioning);
      }

      // Run on window load
      window.addEventListener('load', function() {
        console.log('üîÑ Window loaded, checking Smartsupp...');
        setTimeout(forceSmartsuppPositioning, 1000);
        setTimeout(forceSmartsuppPositioning, 3000);
        setTimeout(forceSmartsuppPositioning, 5000);
      });

      // Run periodically
      setInterval(forceSmartsuppPositioning, 3000);

      // Run on resize
      window.addEventListener('resize', forceSmartsuppPositioning);
    })();
    </script>
  </head>

  <body>
    <div id="root"></div>
    <div id="mobile-fallback" class="mobile-fallback">
      <h2>KORAUTO</h2>
      <p>Loading your premium car experience...</p>
      <p>If this page doesn't load, please refresh or try again.</p>
    </div>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Mobile fallback script -->
    <script>
      // Show mobile fallback if app doesn't load within 5 seconds
      setTimeout(function() {
        const root = document.getElementById('root');
        const fallback = document.getElementById('mobile-fallback');
        if (root && root.children.length === 0 && fallback) {
          fallback.classList.add('show');
        }
      }, 5000);
    </script>
  </body>
</html>
